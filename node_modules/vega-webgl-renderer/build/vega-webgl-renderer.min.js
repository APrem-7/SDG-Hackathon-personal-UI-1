!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("vega-scenegraph"),require("d3-color")):"function"==typeof define&&define.amd?define(["exports","vega-scenegraph","d3-color"],e):e(t.vega=t.vega||{},t.vega,t.d3)}(this,function(t,e,i){"use strict";function n(t){var e=[];return t.replace(ae,function(t,i,n){var a=i.toLowerCase();for(n=r(n),"m"==a&&n.length>2&&(e.push([i].concat(n.splice(0,2))),a="l",i="m"==i?"l":"L");;){if(n.length==re[a])return n.unshift(i),e.push(n);if(n.length<re[a])throw new Error("malformed path data");e.push([i].concat(n.splice(0,re[a])))}}),e}function r(t){var e=t.match(se);return e?e.map(Number):[]}function a(t,e){var i=t[0]-e[0],n=t[1]-e[1];return i*i+n*n}function s(t,e,i){var n=e[0],r=e[1],a=i[0]-n,s=i[1]-r;if(0!==a||0!==s){var o=((t[0]-n)*a+(t[1]-r)*s)/(a*a+s*s);o>1?(n=i[0],r=i[1]):o>0&&(n+=a*o,r+=s*o)}return a=t[0]-n,s=t[1]-r,a*a+s*s}function o(t,e,i,n,r){for(var a,l=n,h=e+1;h<i;h++){var c=s(t[h],t[e],t[i]);c>l&&(a=h,l=c)}l>n&&(a-e>1&&o(t,e,a,n,r),r.push(t[a]),i-a>1&&o(t,a,i,n,r))}function l(t){return[t[0],t[1]]}function h(t,e){return[t,e]}function c(t){var e=0,i=0,n=0,r=0;return t.map(function(t){t=t.slice();var a=t[0],s=a.toUpperCase();if(a!=s)switch(t[0]=s,a){case"a":t[6]+=n,t[7]+=r;break;case"v":t[1]+=r;break;case"h":t[1]+=n;break;default:for(var o=1;o<t.length;)t[o++]+=n,t[o++]+=r}switch(s){case"Z":n=e,r=i;break;case"H":n=t[1];break;case"V":r=t[1];break;case"M":n=e=t[1],r=i=t[2];break;default:n=t[t.length-2],r=t[t.length-1]}return t})}function u(t){for(var e,i=[],n=0,r=0,a=0,s=0,o=null,l=null,h=0,c=0,u=0,p=t.length;u<p;u++){var v=t[u],x=v[0];switch(x){case"M":a=v[1],s=v[2];break;case"A":v=_(h,c,v[1],v[2],g(v[3]),v[4],v[5],v[6],v[7]),v.unshift("C"),v.length>7&&(i.push(v.splice(0,7)),v.unshift("C"));break;case"S":var m=h,y=c;"C"!=e&&"S"!=e||(m+=m-n,y+=y-r),v=["C",m,y,v[1],v[2],v[3],v[4]];break;case"T":"Q"==e||"T"==e?(o=2*h-o,l=2*c-l):(o=h,l=c),v=d(h,c,o,l,v[1],v[2]);break;case"Q":o=v[1],l=v[2],v=d(h,c,v[1],v[2],v[3],v[4]);break;case"L":v=f(h,c,v[1],v[2]);break;case"H":v=f(h,c,v[1],c);break;case"V":v=f(h,c,h,v[1]);break;case"Z":v=f(h,c,a,s)}e=x,h=v[v.length-2],c=v[v.length-1],v.length>4?(n=v[v.length-4],r=v[v.length-3]):(n=h,r=c),i.push(v)}return i}function f(t,e,i,n){return["C",t,e,i,n,i,n]}function d(t,e,i,n,r,a){return["C",t/3+2/3*i,e/3+2/3*n,r/3+2/3*i,a/3+2/3*n,r,a]}function _(t,e,i,n,r,a,s,o,l,h){if(h)b=h[0],L=h[1],m=h[2],y=h[3];else{var c=p(t,e,-r);t=c.x,e=c.y,c=p(o,l,-r),o=c.x,l=c.y;var u=(t-o)/2,f=(e-l)/2,d=u*u/(i*i)+f*f/(n*n);d>1&&(d=Math.sqrt(d),i*=d,n*=d);var g=i*i,v=n*n,x=(a==s?-1:1)*Math.sqrt(Math.abs((g*v-g*f*f-v*u*u)/(g*f*f+v*u*u)));x==1/0&&(x=1);var m=x*i*f/n+(t+o)/2,y=x*-n*u/i+(e+l)/2,b=Math.asin(((e-y)/n).toFixed(9)),L=Math.asin(((l-y)/n).toFixed(9));b=t<m?ve-b:b,L=o<m?ve-L:L,b<0&&(b=2*ve+b),L<0&&(L=2*ve+L),s&&b>L&&(b-=2*ve),!s&&L>b&&(L-=2*ve)}if(Math.abs(L-b)>xe){var A=L,S=o,R=l;L=b+xe*(s&&L>b?1:-1),o=m+i*Math.cos(L),l=y+n*Math.sin(L);var E=_(o,l,i,n,r,0,s,S,R,[L,A,m,y])}var O=Math.tan((L-b)/4),w=4/3*i*O,T=4/3*n*O,k=[2*t-(t+w*Math.sin(b)),2*e-(e-T*Math.cos(b)),o+w*Math.sin(L),l-T*Math.cos(L),o,l];if(h)return k;E&&(k=k.concat(E));for(var C=0;C<k.length;){var V=p(k[C],k[C+1],r);k[C++]=V.x,k[C++]=V.y}return k}function p(t,e,i){return{x:t*Math.cos(i)-e*Math.sin(i),y:t*Math.sin(i)+e*Math.cos(i)}}function g(t){return t*(ve/180)}function v(t,e,i){return t[0]=e,t[1]=i,t}function x(t,e,i,n){be(i,v(Re,n[1],n[2]),v(Ee,n[3],n[4]),v(Oe,n[5],n[6]),e,t)}function m(){this.next=null,this.prev=null,this.anEdge=null,this.coords=[0,0,0],this.s=0,this.t=0,this.pqHandle=0,this.n=0,this.idx=0}function y(){this.next=null,this.prev=null,this.anEdge=null,this.trail=null,this.n=0,this.marked=!1,this.inside=!1}function b(t){this.next=null,this.Sym=null,this.Onext=null,this.Lnext=null,this.Org=null,this.Lface=null,this.activeRegion=null,this.winding=0,this.side=t}function L(){var t=new m,e=new y,i=new b(0),n=new b(1);t.next=t.prev=t,t.anEdge=null,e.next=e.prev=e,e.anEdge=null,e.trail=null,e.marked=!1,e.inside=!1,i.next=i,i.Sym=n,i.Onext=null,i.Lnext=null,i.Org=null,i.Lface=null,i.winding=0,i.activeRegion=null,n.next=n,n.Sym=i,n.Onext=null,n.Lnext=null,n.Org=null,n.Lface=null,n.winding=0,n.activeRegion=null,this.vHead=t,this.fHead=e,this.eHead=i,this.eHeadSym=n}function A(){this.key=null,this.next=null,this.prev=null}function S(t,e){this.head=new A,this.head.next=this.head,this.head.prev=this.head,this.frame=t,this.leq=e}function R(){this.handle=null}function E(){this.key=null,this.node=null}function O(t,e){this.size=0,this.max=t,this.nodes=[],this.nodes.length=t+1;for(var i=0;i<this.nodes.length;i++)this.nodes[i]=new R;this.handles=[],this.handles.length=t+1;for(var i=0;i<this.handles.length;i++)this.handles[i]=new E;this.initialized=!1,this.freeList=0,this.leq=e,this.nodes[1].handle=1,this.handles[1].key=null}function w(){this.eUp=null,this.nodeUp=null,this.windingNumber=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperEdge=!1}function T(){this.mesh=null,this.normal=[0,0,0],this.sUnit=[0,0,0],this.tUnit=[0,0,0],this.bmin=[0,0],this.bmax=[0,0],this.windingRule=Te.WINDING_ODD,this.dict=null,this.pq=null,this.event=null,this.vertexIndexCounter=0,this.vertices=[],this.vertexIndices=[],this.vertexCount=0,this.elements=[],this.elementCount=0}function k(){for(var t={},e=0;e<arguments.length;e++){var i=arguments[e];for(var n in i)Ue.call(i,n)&&(t[n]=i[n])}return t}function C(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function V(){return new C}function F(t){return t.innerRadius}function D(t){return t.outerRadius}function B(t){return t.startAngle}function U(t){return t.endAngle}function M(t){return t&&t.padAngle}function P(t){return t>=1?Xe:t<=-1?-Xe:Math.asin(t)}function q(t,e,i,n,r,a,s,o){var l=i-t,h=n-e,c=s-r,u=o-a,f=(c*(e-a)-u*(t-r))/(u*l-c*h);return[t+f*l,e+f*h]}function z(t,e,i,n,r,a,s){var o=t-i,l=e-n,h=(s?a:-a)/Math.sqrt(o*o+l*l),c=h*l,u=-h*o,f=t+c,d=e+u,_=i+c,p=n+u,g=(f+_)/2,v=(d+p)/2,x=_-f,m=p-d,y=x*x+m*m,b=r-a,L=f*p-_*d,A=(m<0?-1:1)*Math.sqrt(Math.max(0,b*b*y-L*L)),S=(L*m-x*A)/y,R=(-L*x-m*A)/y,E=(L*m+x*A)/y,O=(-L*x+m*A)/y,w=S-g,T=R-v,k=E-g,C=O-v;return w*w+T*T>k*k+C*C&&(S=E,R=O),{cx:S,cy:R,x01:-c,y01:-u,x11:S*(r/b-1),y11:R*(r/b-1)}}function I(t){this._context=t}function N(t){return t[0]}function W(t){return t[1]}function H(t){this._curve=t}function Y(t){function e(e){return new H(t(e))}return e._curve=t,e}function G(t,e,i){t._context.bezierCurveTo((2*t._x0+t._x1)/3,(2*t._y0+t._y1)/3,(t._x0+2*t._x1)/3,(t._y0+2*t._y1)/3,(t._x0+4*t._x1+e)/6,(t._y0+4*t._y1+i)/6)}function j(t){this._context=t}function X(t,e){this._basis=new j(t),this._beta=e}function Z(t,e,i){t._context.bezierCurveTo(t._x1+t._k*(t._x2-t._x0),t._y1+t._k*(t._y2-t._y0),t._x2+t._k*(t._x1-e),t._y2+t._k*(t._y1-i),t._x2,t._y2)}function Q(t,e){this._context=t,this._k=(1-e)/6}function J(t,e){this._context=t,this._k=(1-e)/6}function K(t,e){this._context=t,this._k=(1-e)/6}function $(t,e,i){var n=t._x1,r=t._y1,a=t._x2,s=t._y2;if(t._l01_a>Ge){var o=2*t._l01_2a+3*t._l01_a*t._l12_a+t._l12_2a,l=3*t._l01_a*(t._l01_a+t._l12_a);n=(n*o-t._x0*t._l12_2a+t._x2*t._l01_2a)/l,r=(r*o-t._y0*t._l12_2a+t._y2*t._l01_2a)/l}if(t._l23_a>Ge){var h=2*t._l23_2a+3*t._l23_a*t._l12_a+t._l12_2a,c=3*t._l23_a*(t._l23_a+t._l12_a);a=(a*h+t._x1*t._l23_2a-e*t._l12_2a)/c,s=(s*h+t._y1*t._l23_2a-i*t._l12_2a)/c}t._context.bezierCurveTo(n,r,a,s,t._x2,t._y2)}function tt(t,e){this._context=t,this._alpha=e}function et(t,e){this._context=t,this._alpha=e}function it(t,e){this._context=t,this._alpha=e}function nt(t){return t<0?-1:1}function rt(t,e,i){var n=t._x1-t._x0,r=e-t._x1,a=(t._y1-t._y0)/(n||r<0&&-0),s=(i-t._y1)/(r||n<0&&-0),o=(a*r+s*n)/(n+r);return(nt(a)+nt(s))*Math.min(Math.abs(a),Math.abs(s),.5*Math.abs(o))||0}function at(t,e){var i=t._x1-t._x0;return i?(3*(t._y1-t._y0)/i-e)/2:e}function st(t,e,i){var n=t._x0,r=t._y0,a=t._x1,s=t._y1,o=(a-n)/3;t._context.bezierCurveTo(n+o,r+o*e,a-o,s-o*i,a,s)}function ot(t){this._context=t}function lt(t){this._context=new ht(t)}function ht(t){this._context=t}function ct(t){return t.x||0}function ut(t){return t.y||0}function ft(t){return t.width||0}function dt(t){return t.width||t.height||1}function _t(t){return t.height||0}function pt(t){return(t.x||0)+(t.width||0)}function gt(t){return(t.y||0)+(t.height||0)}function vt(t){return t.cornerRadius||0}function xt(t){return t.padAngle||0}function mt(t){return!(t.defined===!1)}function yt(t){return null==t.size?64:t.size}function bt(t){return e.pathSymbols(t.shape||"circle")}function Lt(t,e){return!t||t.arc?ni.context(t)(e):ze(t,ni.context(null)(e),.1)}function At(t,i){var n=i[0],r=n.interpolate||"linear",a="trail"===r?oi:("horizontal"===n.orient?ai:ri).curve(e.pathCurves(r,n.orient,n.tension));return!t||t.arc?a.context(t)(i):ze(t,a.context(null)(i),.1)}function St(t,e){var i=e.mark.shape||e.shape;return!t||t.arc?i.context(t)(e):ze(t,i.context(null)(e),.1)}function Rt(t,i){var n=i[0],r=n.interpolate||"linear",a=si.curve(e.pathCurves(r,n.orient,n.tension));return!t||t.arc?a.context(t)(i):ze(t,a.context(null)(i))}function Et(t,e,i,n){return ze(t,li.context(null)(e,i,n),.1)}function Ot(t,e){return t[0]=e[0],t[1]=e[1],t}function wt(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t}function Tt(t,e){return t[0]*e[0]+t[1]*e[1]}function kt(t){return[t[0],t[1]]}function Ct(){return[0,0]}function Vt(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t}function Ft(t,e,i){return t[0]=e,t[1]=i,t}function Dt(t,e){var i=e[0],n=e[1],r=i*i+n*n;return r>0&&(r=1/Math.sqrt(r),t[0]=e[0]*r,t[1]=e[1]*r),t}function Bt(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t}function Ut(t){return this instanceof Ut?(t=t||{},this.miterLimit=Ci(t.miterLimit,10),this.thickness=Ci(t.thickness,1),this.join=t.join||"miter",this.cap=t.cap||"butt",this._normal=null,this._lastFlip=-1,void(this._started=!1)):new Ut(t)}function Mt(t,e,i,n){Vi.scaleAndAdd(Fi,e,i,-n),t.push(Vi.clone(Fi)),Vi.scaleAndAdd(Fi,e,i,n),t.push(Vi.clone(Fi))}function Pt(t,i,n){var r=this;e.sceneVisit(i,function(i){var a,s,o=i.x||0,l=i.y||0,h=i.width||0,c=i.height||0;if(t._tx+=o,t._ty+=l,t._textContext.save(),t._textContext.translate(o,l),t._fullRedraw||i._dirty||!i._geom||i._geom.deleted){a=i.stroke?.5:0;var u=Et(t,i,a,a);i._geom=Hi(t,i,u)}hi(i._geom,t,i),i.clip&&(s=t._clip,t._clip=[t._origin[0]+t._tx,t._origin[1]+t._ty,t._origin[0]+t._tx+h,t._origin[1]+t._ty+c]),n&&n.translate(-o,-l),e.sceneVisit(i,function(e){r.draw(t,e,n)}),n&&n.translate(o,l),i.clip&&(t._clip=s),t._tx-=o,t._ty-=l,t._textContext.restore()})}function qt(t,e){for(var i=[0,0,4,1,8,2,12,3,1,0,5,1,9,2,13,3,2,0,6,1,10,2,14,3,3,0,7,1,11,2,15,3,0,4,4,5,8,6,12,7,1,4,5,5,9,6,13,7,2,4,6,5,10,6,14,7,3,4,7,5,11,6,15,7,0,8,4,9,8,10,12,11,1,8,5,9,9,10,13,11,2,8,6,9,10,10,14,11,3,8,7,9,11,10,15,11,0,12,4,13,8,14,12,15,1,12,5,13,9,14,13,15,2,12,6,13,10,14,14,15,3,12,7,13,11,14,15,15],n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],r=0;r<i.length/2;r++)n[Math.floor(r/4)]+=t[i[2*r]]*e[i[2*r+1]];return n}function zt(t,e,i,n){var r=Math.tan(.5*Math.PI-.5*t),a=1/(i-n);return[r/e,0,0,0,0,r,0,0,0,0,(i+n)*a,-1,0,0,i*n*a*2,0]}function It(t){return[1,0,0,0,0,Math.cos(t),Math.sin(t),0,0,-Math.sin(t),Math.cos(t),0,0,0,0,1]}function Nt(t){return[Math.cos(t),0,-Math.sin(t),0,0,1,0,0,Math.sin(t),0,Math.cos(t),0,0,0,0,1]}function Wt(t){return[Math.cos(t),Math.sin(t),0,0,-Math.sin(t),Math.cos(t),0,0,0,0,1,0,0,0,0,1]}function Ht(t,e,i){return[1,0,0,0,0,1,0,0,0,0,1,0,t,e,i,1]}function Yt(t,e){var i=t.createTexture();t.bindTexture(t.TEXTURE_2D,i),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array([0,0,255,255])),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR);var n={texture:i};return n.width=e.width,n.height=e.height,t.bindTexture(t.TEXTURE_2D,n.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),n}function Gt(t,e,i){t.bindTexture(t.TEXTURE_2D,e.texture),t.useProgram(t._imageShaderProgram),t.bindBuffer(t.ARRAY_BUFFER,t._imagePositionBuffer),t.enableVertexAttribArray(t._imagePositionLocation),t.vertexAttribPointer(t._imagePositionLocation,2,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,t._imageTexcoordBuffer),t.enableVertexAttribArray(t._imageTexcoordLocation),t.vertexAttribPointer(t._imageTexcoordLocation,2,t.FLOAT,!1,0,0);var n=[e.w,0,0,0,0,e.h,0,0,0,0,1,0,e.x,e.y,0,1];i=qt(i,n),t.uniformMatrix4fv(t._imageMatrixLocation,!1,i),t.uniform1i(t._imageTextureLocation,0),t.drawArrays(t.TRIANGLES,0,6)}function jt(t,e){var i=t.image;return i&&i.url===t.url||(i={loaded:!1,width:0,height:0},e.loadImage(t.url).then(function(e){t.image=e,t.image.url=t.url})),i}function Xt(t,e){return"center"===t?e/2:"right"===t?e:0}function Zt(t,e){return"middle"===t?e/2:"bottom"===t?e:0}function Qt(t,i,n){var r=this;e.sceneVisit(i,function(e){if(!n||n.intersects(e.bounds)){var i=jt(e,r),a=e.x||0,s=e.y||0,o=e.width||i.width||0,l=e.height||i.height||0;if(a-=Xt(e.align,o),s-=Zt(e.baseline,l),i.loaded){var h=Yt(t,i);h.x=a+t._tx+t._origin[0],h.y=s+t._ty+t._origin[1],h.w=o,h.h=l,t._images.push(h)}}})}function Jt(t,i){e.sceneVisit(i,function(e){var i=e.path;if(null==i)return!0;var n=e.x||0,r=e.y||0;if(t._tx+=n,t._ty+=r,t._fullRedraw||e._dirty||!e._geom||e._geom.deleted){var a=ze(t,i);e._geom=Hi(t,e,a)}hi(e._geom,t,e),t._tx-=n,t._ty-=r})}function Kt(t,i,n){var r,a,s,o,l,h,c,u,f,d,_,p,g,v,x,m,y,b,L,A,S,R=0,E=0,O=0,w=i.items.length,T=!1,k=i._rectGeom;for(A=0;A<i.items.length;++A)if(S=i.items[A],S.stroke&&S.stroke.id||S.fill&&S.fill.id){T=!0;break}if(T)return void e.Marks.rect.draw(t._textContext,i,n);if(k&&k.numPts===w)r=k.unit,d=k.unitBuffer,a=k.pos,s=k.size,o=k.strokeWidth,l=k.strokeOpacity,h=k.strokeColor,c=k.fillOpacity,u=k.fillColor,f=k.cornerRadius;else for(k&&t.deleteBuffer(k.unitBuffer),r=new Float32Array(6*w*2),a=new Float32Array(6*w*3),s=new Float32Array(6*w*2),o=new Float32Array(6*w),l=new Float32Array(6*w),h=new Float32Array(6*w*3),c=new Float32Array(6*w),u=new Float32Array(6*w*3),f=new Float32Array(6*w),L=[0,1,1,1,1,0,1,0,0,0,0,1],A=0;A<w*L.length;A+=1)r[A]=L[A%L.length];k&&(t.deleteBuffer(k.posBuffer),t.deleteBuffer(k.sizeBuffer),t.deleteBuffer(k.strokeWidthBuffer),t.deleteBuffer(k.strokeOpacityBuffer),t.deleteBuffer(k.strokeColorBuffer),t.deleteBuffer(k.fillOpacityBuffer),t.deleteBuffer(k.fillColorBuffer),t.deleteBuffer(k.cornerRadiusBuffer)),e.sceneVisit(i,function(e){var i=(e.x||0)+t._tx+t._origin[0],n=(e.y||0)+t._ty+t._origin[1],r=ui(t,e,e.fill),d=ui(t,e,e.stroke),_=null==e.opacity?1:e.opacity,p=_*(null==e.fill||"transparent"==e.fill?0:1)*(null==e.fillOpacity?1:e.fillOpacity),g=_*(null==e.stroke||"transparent"==e.stroke?0:1)*(null==e.strokeOpacity?1:e.strokeOpacity),v=(null==e.stroke||"transparent"==e.stroke?0:1)*(null==e.strokeWidth?1:e.strokeWidth),x=null==e.width?0:e.width,m=null==e.height?0:e.height,y=null==e.cornerRadius?0:e.cornerRadius;for(A=0;A<6;A+=1,R+=1,E+=2,O+=3)a[O]=i,a[O+1]=n,a[O+2]=0,s[E]=x,s[E+1]=m,o[R]=v,l[R]=g,h[O]=d[0],h[O+1]=d[1],h[O+2]=d[2],c[R]=p,u[O]=r[0],u[O+1]=r[1],u[O+2]=r[2],f[R]=y}),t.useProgram(t._rectShaderProgram),d?(t.bindBuffer(t.ARRAY_BUFFER,d),t.vertexAttribPointer(t._rectUnitLocation,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(t._rectUnitLocation)):(d=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,d),t.bufferData(t.ARRAY_BUFFER,r,t.STATIC_DRAW),t.vertexAttribPointer(t._rectUnitLocation,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(t._rectUnitLocation)),_=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,_),t.bufferData(t.ARRAY_BUFFER,a,t.STATIC_DRAW),t.vertexAttribPointer(t._rectPosLocation,3,t.FLOAT,!1,0,0),t.enableVertexAttribArray(t._rectPosLocation),p=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,p),t.bufferData(t.ARRAY_BUFFER,s,t.STATIC_DRAW),t.vertexAttribPointer(t._rectSizeLocation,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(t._rectSizeLocation),g=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,g),t.bufferData(t.ARRAY_BUFFER,o,t.STATIC_DRAW),t.vertexAttribPointer(t._rectStrokeWidthLocation,1,t.FLOAT,!1,0,0),t.enableVertexAttribArray(t._rectStrokeWidthLocation),v=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,v),t.bufferData(t.ARRAY_BUFFER,l,t.STATIC_DRAW),t.vertexAttribPointer(t._rectStrokeOpacityLocation,1,t.FLOAT,!1,0,0),t.enableVertexAttribArray(t._rectStrokeOpacityLocation),x=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,x),t.bufferData(t.ARRAY_BUFFER,h,t.STATIC_DRAW),t.vertexAttribPointer(t._rectStrokeColorLocation,3,t.FLOAT,!1,0,0),t.enableVertexAttribArray(t._rectStrokeColorLocation),m=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,m),t.bufferData(t.ARRAY_BUFFER,c,t.STATIC_DRAW),t.vertexAttribPointer(t._rectFillOpacityLocation,1,t.FLOAT,!1,0,0),t.enableVertexAttribArray(t._rectFillOpacityLocation),y=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,y),t.bufferData(t.ARRAY_BUFFER,u,t.STATIC_DRAW),t.vertexAttribPointer(t._rectFillColorLocation,3,t.FLOAT,!1,0,0),t.enableVertexAttribArray(t._rectFillColorLocation),b=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,b),t.bufferData(t.ARRAY_BUFFER,f,t.STATIC_DRAW),t.vertexAttribPointer(t._rectCornerRadiusLocation,1,t.FLOAT,!1,0,0),t.enableVertexAttribArray(t._rectCornerRadiusLocation),t.uniformMatrix4fv(t._rectMatrixLocation,!1,t._matrix),t.uniform4fv(t._rectClipLocation,t._clip),t.drawArrays(t.TRIANGLES,0,6*w),i._rectGeom={numPts:w,unit:r,pos:a,size:s,strokeWidth:o,strokeOpacity:l,strokeColor:h,fillOpacity:c,fillColor:u,cornerRadius:f,unitBuffer:d,posBuffer:_,sizeBuffer:p,strokeWidthBuffer:g,strokeOpacityBuffer:v,strokeColorBuffer:x,fillOpacityBuffer:m,fillColorBuffer:y,cornerRadiusBuffer:b}}function $t(t,i,n){e.sceneVisit(i,function(e){var i,r,a,s,o;n&&!n.intersects(e.bounds)||((t._fullRedraw||e._dirty||!e._geom||e._geom.deleted)&&(i=e.x||0,r=e.y||0,a=null!=e.x2?e.x2:i,s=null!=e.y2?e.y2:r,o={lines:[[[i,r],[a,s]]],closed:!1},o.key=JSON.stringify(o.lines),e._geom=Hi(t,e,o)),hi(e._geom,t,e))})}function te(t,i){var n,r,a,s,o,l,h,c,u,f,d,_,p,g,v,x,m,y,b,L,A,S=0,R=0,E=i.items.length,O=0,w=0,T=1,k=1,C=i._symbolGeom;if(0!==E){if(A={circle:0,cross:1,diamond:2,square:3,star:4,triangle:5,"triangle-up":5,"triangle-right":6,"triangle-down":7,"triangle-left":8,wye:9},C&&C.numPts===E)n=C.unit,f=C.unitBuffer,r=C.pos,a=C.size,s=C.shape,o=C.strokeWidth,l=C.strokeOpacity,h=C.strokeColor,c=C.fillOpacity,u=C.fillColor;else for(C&&t.deleteBuffer(C.unitBuffer),n=new Float32Array(3*E*2),r=new Float32Array(3*E*3),a=new Float32Array(3*E),s=new Float32Array(3*E),o=new Float32Array(3*E),l=new Float32Array(3*E),h=new Float32Array(3*E*3),c=new Float32Array(3*E),u=new Float32Array(3*E*3),L=[O,w-2*k,O-T*Math.sqrt(3),w+k,O+T*Math.sqrt(3),w+k],b=0;b<E*L.length;b+=1)n[b]=L[b%L.length];C&&(t.deleteBuffer(C.posBuffer),t.deleteBuffer(C.sizeBuffer),t.deleteBuffer(C.shapeBuffer),t.deleteBuffer(C.strokeWidthBuffer),t.deleteBuffer(C.strokeOpacityBuffer),t.deleteBuffer(C.strokeColorBuffer),t.deleteBuffer(C.fillOpacityBuffer),t.deleteBuffer(C.fillColorBuffer)),e.sceneVisit(i,function(e){var i=(e.x||0)+t._tx+t._origin[0],n=(e.y||0)+t._ty+t._origin[1],f=ui(t,e,e.fill),d=ui(t,e,e.stroke),_=null==e.opacity?1:e.opacity,p=_*(null==e.fill||"transparent"==e.fill?0:1)*(null==e.fillOpacity?1:e.fillOpacity),g=_*(null==e.stroke||"transparent"==e.stroke?0:1)*(null==e.strokeOpacity?1:e.strokeOpacity),v=(null==e.stroke||"transparent"==e.stroke?0:1)*(null==e.strokeWidth?1:e.strokeWidth),x=null==e.size?64:e.size,m=void 0==A[e.shape]?0:A[e.shape];for(b=0;b<3;b+=1,S+=1,R+=3)r[R]=i,r[R+1]=n,r[R+2]=0,a[S]=x,o[S]=v,s[S]=m,l[S]=g,h[R]=d[0],h[R+1]=d[1],h[R+2]=d[2],c[S]=p,u[R]=f[0],u[R+1]=f[1],u[R+2]=f[2]}),t.useProgram(t._symbolShaderProgram),f?(t.bindBuffer(t.ARRAY_BUFFER,f),t.vertexAttribPointer(t._symbolUnitLocation,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(t._symbolUnitLocation)):(f=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,f),t.bufferData(t.ARRAY_BUFFER,n,t.STATIC_DRAW),t.vertexAttribPointer(t._symbolUnitLocation,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(t._symbolUnitLocation)),d=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,d),t.bufferData(t.ARRAY_BUFFER,r,t.STATIC_DRAW),t.vertexAttribPointer(t._symbolPosLocation,3,t.FLOAT,!1,0,0),t.enableVertexAttribArray(t._symbolPosLocation),_=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,_),t.bufferData(t.ARRAY_BUFFER,a,t.STATIC_DRAW),t.vertexAttribPointer(t._symbolSizeLocation,1,t.FLOAT,!1,0,0),t.enableVertexAttribArray(t._symbolSizeLocation),p=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,p),t.bufferData(t.ARRAY_BUFFER,s,t.STATIC_DRAW),t.vertexAttribPointer(t._symbolShapeLocation,1,t.FLOAT,!1,0,0),t.enableVertexAttribArray(t._symbolShapeLocation),g=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,g),t.bufferData(t.ARRAY_BUFFER,o,t.STATIC_DRAW),t.vertexAttribPointer(t._symbolStrokeWidthLocation,1,t.FLOAT,!1,0,0),t.enableVertexAttribArray(t._symbolStrokeWidthLocation),v=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,v),t.bufferData(t.ARRAY_BUFFER,l,t.STATIC_DRAW),t.vertexAttribPointer(t._symbolStrokeOpacityLocation,1,t.FLOAT,!1,0,0),t.enableVertexAttribArray(t._symbolStrokeOpacityLocation),x=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,x),t.bufferData(t.ARRAY_BUFFER,h,t.STATIC_DRAW),t.vertexAttribPointer(t._symbolStrokeColorLocation,3,t.FLOAT,!1,0,0),t.enableVertexAttribArray(t._symbolStrokeColorLocation),m=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,m),t.bufferData(t.ARRAY_BUFFER,c,t.STATIC_DRAW),t.vertexAttribPointer(t._symbolFillOpacityLocation,1,t.FLOAT,!1,0,0),t.enableVertexAttribArray(t._symbolFillOpacityLocation),y=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,y),t.bufferData(t.ARRAY_BUFFER,u,t.STATIC_DRAW),t.vertexAttribPointer(t._symbolFillColorLocation,3,t.FLOAT,!1,0,0),t.enableVertexAttribArray(t._symbolFillColorLocation),t.uniformMatrix4fv(t._symbolMatrixLocation,!1,t._matrix),t.uniform4fv(t._symbolClipLocation,t._clip),t.drawArrays(t.TRIANGLES,0,3*E),i._symbolGeom={numPts:E,unit:n,pos:r,size:a,shape:s,strokeWidth:o,strokeOpacity:l,strokeColor:h,fillOpacity:c,fillColor:u,unitBuffer:f,posBuffer:d,sizeBuffer:_,shapeBuffer:p,strokeWidthBuffer:g,strokeOpacityBuffer:v,strokeColorBuffer:x,fillOpacityBuffer:m,fillColorBuffer:y}}}function ee(t,i,n){e.Marks.text.draw(t._textContext,i,n)}function ie(t){e.Renderer.call(this,t),this._redraw=!1,this._angleX=0,this._angleY=0,this._angleZ=0,this._translateX=0,this._translateY=0,this._translateZ=0,this._zFactor=0,this._depthTest=!1,this._randomZ=!1}var ne=n,re={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},ae=/([astvzqmhlc])([^astvzqmhlc]*)/gi,se=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/gi,oe=function(t,e){if(t.length<=1)return t;e="number"==typeof e?e:1;for(var i,n=e*e,r=t[0],s=[r],o=1,l=t.length;o<l;o++)i=t[o],a(i,r)>n&&(s.push(i),r=i);return r!==i&&s.push(i),s},le=function(t,e){if(t.length<=1)return t;e="number"==typeof e?e:1;var i=e*e,n=t.length-1,r=[t[0]];return o(t,0,n,i,r),r.push(t[n]),r},he=oe,ce=le,ue=function(t,e){return t=he(t,e),t=ce(t,e)},fe=he,de=ce;ue.radialDistance=fe,ue.douglasPeucker=de;var _e=function(t){function e(t,e,n,r,a,s){a.push(l(t));var o=t[0],h=t[1],c=e[0],u=e[1],f=n[0],d=n[1],_=r[0],p=r[1];i(o,h,c,u,f,d,_,p,a,s,0),a.push(l(r))}function i(t,e,a,l,u,f,d,_,p,g,v){if(!(v>n)){var x=Math.PI,m=(t+a)/2,y=(e+l)/2,b=(a+u)/2,L=(l+f)/2,A=(u+d)/2,S=(f+_)/2,R=(m+b)/2,E=(y+L)/2,O=(b+A)/2,w=(L+S)/2,T=(R+O)/2,k=(E+w)/2;if(v>0){var C,V,F=d-t,D=_-e,B=Math.abs((a-d)*D-(l-_)*F),U=Math.abs((u-d)*D-(f-_)*F);if(B>r&&U>r){if((B+U)*(B+U)<=g*(F*F+D*D)){if(o<s)return void p.push(h(T,k));var M=Math.atan2(f-l,u-a);if(C=Math.abs(M-Math.atan2(l-e,a-t)),V=Math.abs(Math.atan2(_-f,d-u)-M),C>=x&&(C=2*x-C),V>=x&&(V=2*x-V),C+V<o)return void p.push(h(T,k));if(0!==c){if(C>c)return void p.push(h(a,l));if(V>c)return void p.push(h(u,f))}}}else if(B>r){if(B*B<=g*(F*F+D*D)){if(o<s)return void p.push(h(T,k));if(C=Math.abs(Math.atan2(f-l,u-a)-Math.atan2(l-e,a-t)),C>=x&&(C=2*x-C),C<o)return p.push(h(a,l)),void p.push(h(u,f));if(0!==c&&C>c)return void p.push(h(a,l))}}else if(U>r){if(U*U<=g*(F*F+D*D)){if(o<s)return void p.push(h(T,k));if(C=Math.abs(Math.atan2(_-f,d-u)-Math.atan2(f-l,u-a)),C>=x&&(C=2*x-C),C<o)return p.push(h(a,l)),void p.push(h(u,f));if(0!==c&&C>c)return void p.push(h(u,f))}}else if(F=T-(t+d)/2,D=k-(e+_)/2,F*F+D*D<=g)return void p.push(h(T,k))}i(t,e,m,y,R,E,T,k,p,g,v+1),i(T,k,O,w,A,S,d,_,p,g,v+1)}}t=t||{};var n="number"==typeof t.recursion?t.recursion:8,r="number"==typeof t.epsilon?t.epsilon:1.1920929e-7,a="number"==typeof t.pathEpsilon?t.pathEpsilon:1,s="number"==typeof t.angleEpsilon?t.angleEpsilon:.01,o=t.angleTolerance||0,c=t.cuspLimit||0;return function(t,i,n,r,s,o){o||(o=[]),s="number"==typeof s?s:1;var l=a/s;return l*=l,e(t,i,n,r,o,l),o}},pe=_e(),ge=c,ve=Math.PI,xe=g(120),me=u,ye=function(t,e){return t[0]=e[0],t[1]=e[1],t},be=pe,Le=ge,Ae=me,Se=ye,Re=[0,0],Ee=[0,0],Oe=[0,0],we=function(t,e){var i=[],n=[],r=[0,0];return Ae(Le(t)).forEach(function(t,a,s){if("M"===t[0])Se(r,t.slice(1)),n.length>0&&(i.push(n),n=[]);else{if("C"!==t[0])throw new Error("illegal type in SVG: "+t[0]);x(n,e,r,t),v(r,t[5],t[6])}}),n.length>0&&i.push(n),i},Te={},ke=Te;Te.WINDING_ODD=0,Te.WINDING_NONZERO=1,Te.WINDING_POSITIVE=2,Te.WINDING_NEGATIVE=3,Te.WINDING_ABS_GEQ_TWO=4,Te.POLYGONS=0,Te.CONNECTED_POLYGONS=1,Te.BOUNDARY_CONTOURS=2,Te.tesselate=function(t){for(var e=t.debug||!1,i=new T,n=0;n<t.contours.length;n++)i.addContour(t.vertexSize||2,t.contours[n]);return i.tesselate(t.windingRule||Te.WINDING_ODD,t.elementType||Te.POLYGONS,t.polySize||3,t.vertexSize||2,t.normal||[0,0,1]),{vertices:i.vertices,vertexIndices:i.vertexIndices,vertexCount:i.vertexCount,elements:i.elements,elementCount:i.elementCount,mesh:e?i.mesh:void 0}};var Ce=function(t){if(!t)throw"Assertion Failed!"};b.prototype={get Rface(){return this.Sym.Lface},set Rface(t){this.Sym.Lface=t},get Dst(){return this.Sym.Org},set Dst(t){this.Sym.Org=t},get Oprev(){return this.Sym.Lnext},set Oprev(t){this.Sym.Lnext=t},get Lprev(){return this.Onext.Sym},set Lprev(t){this.Onext.Sym=t},get Dprev(){return this.Lnext.Sym},set Dprev(t){this.Lnext.Sym=t},get Rprev(){return this.Sym.Onext},set Rprev(t){this.Sym.Onext=t},get Dnext(){return this.Sym.Onext.Sym},set Dnext(t){this.Sym.Onext.Sym=t},get Rnext(){return this.Sym.Lnext.Sym},set Rnext(t){this.Sym.Lnext.Sym=t}},L.prototype={makeEdge_:function(t){var e=new b(0),i=new b(1);t.Sym.side<t.side&&(t=t.Sym);var n=t.Sym.next;return i.next=n,n.Sym.next=e,e.next=t,t.Sym.next=i,e.Sym=i,e.Onext=e,e.Lnext=i,e.Org=null,e.Lface=null,e.winding=0,e.activeRegion=null,i.Sym=e,i.Onext=i,i.Lnext=e,i.Org=null,i.Lface=null,i.winding=0,i.activeRegion=null,e},splice_:function(t,e){var i=t.Onext,n=e.Onext;i.Sym.Lnext=e,n.Sym.Lnext=t,t.Onext=n,e.Onext=i},makeVertex_:function(t,e,i){var n=t;Ce(null!==n);var r=i.prev;n.prev=r,r.next=n,n.next=i,i.prev=n,n.anEdge=e;var a=e;do a.Org=n,a=a.Onext;while(a!==e)},makeFace_:function(t,e,i){var n=t;Ce(null!==n);var r=i.prev;n.prev=r,r.next=n,n.next=i,i.prev=n,n.anEdge=e,n.trail=null,n.marked=!1,n.inside=i.inside;var a=e;do a.Lface=n,a=a.Lnext;while(a!==e)},killEdge_:function(t){t.Sym.side<t.side&&(t=t.Sym);var e=t.next,i=t.Sym.next;e.Sym.next=i,i.Sym.next=e},killVertex_:function(t,e){var i=t.anEdge,n=i;do n.Org=e,n=n.Onext;while(n!==i);var r=t.prev,a=t.next;a.prev=r,r.next=a},killFace_:function(t,e){var i=t.anEdge,n=i;do n.Lface=e,n=n.Lnext;while(n!==i);var r=t.prev,a=t.next;a.prev=r,r.next=a},makeEdge:function(){var t=new m,e=new m,i=new y,n=this.makeEdge_(this.eHead);return this.makeVertex_(t,n,this.vHead),this.makeVertex_(e,n.Sym,this.vHead),this.makeFace_(i,n,this.fHead),n},splice:function(t,e){var i=!1,n=!1;if(t!==e){if(e.Org!==t.Org&&(n=!0,this.killVertex_(e.Org,t.Org)),e.Lface!==t.Lface&&(i=!0,this.killFace_(e.Lface,t.Lface)),this.splice_(e,t),!n){var r=new m;this.makeVertex_(r,e,t.Org),t.Org.anEdge=t}if(!i){var a=new y;this.makeFace_(a,e,t.Lface),t.Lface.anEdge=t}}},delete:function(t){var e=t.Sym,i=!1;if(t.Lface!==t.Rface&&(i=!0,this.killFace_(t.Lface,t.Rface)),t.Onext===t)this.killVertex_(t.Org,null);else if(t.Rface.anEdge=t.Oprev,t.Org.anEdge=t.Onext,this.splice_(t,t.Oprev),!i){var n=new y;this.makeFace_(n,t,t.Lface)}e.Onext===e?(this.killVertex_(e.Org,null),this.killFace_(e.Lface,null)):(t.Lface.anEdge=e.Oprev,e.Org.anEdge=e.Onext,this.splice_(e,e.Oprev)),this.killEdge_(t)},addEdgeVertex:function(t){var e=this.makeEdge_(t),i=e.Sym;this.splice_(e,t.Lnext),e.Org=t.Dst;var n=new m;return this.makeVertex_(n,i,e.Org),e.Lface=i.Lface=t.Lface,e},splitEdge:function(t,e){var i=this.addEdgeVertex(t),n=i.Sym;return this.splice_(t.Sym,t.Sym.Oprev),this.splice_(t.Sym,n),t.Dst=n.Org,n.Dst.anEdge=n.Sym,n.Rface=t.Rface,n.winding=t.winding,n.Sym.winding=t.Sym.winding,n},connect:function(t,e){var i=!1,n=this.makeEdge_(t),r=n.Sym;if(e.Lface!==t.Lface&&(i=!0,this.killFace_(e.Lface,t.Lface)),this.splice_(n,t.Lnext),this.splice_(r,e),n.Org=t.Dst,r.Org=e.Org,n.Lface=r.Lface=t.Lface,t.Lface.anEdge=r,!i){var a=new y;this.makeFace_(a,n,t.Lface)}return n},zapFace:function(t){var e,i,n,r,a,s=t.anEdge;i=s.Lnext;do e=i,i=e.Lnext,e.Lface=null,null===e.Rface&&(e.Onext===e?this.killVertex_(e.Org,null):(e.Org.anEdge=e.Onext,this.splice_(e,e.Oprev)),n=e.Sym,n.Onext===n?this.killVertex_(n.Org,null):(n.Org.anEdge=n.Onext,this.splice_(n,n.Oprev)),this.killEdge_(e));while(e!=s);r=t.prev,a=t.next,a.prev=r,r.next=a},countFaceVerts_:function(t){var e=t.anEdge,i=0;do i++,e=e.Lnext;while(e!==t.anEdge);return i},mergeConvexFaces:function(t){var e,i,n,r,a,s,o;for(e=this.fHead.next;e!==this.fHead;e=e.next)if(e.inside)for(i=e.anEdge,a=i.Org;;){if(n=i.Lnext,r=i.Sym,r&&r.Lface&&r.Lface.inside&&(s=this.countFaceVerts_(e),o=this.countFaceVerts_(r.Lface),s+o-2<=t&&Ve.vertCCW(i.Lprev.Org,i.Org,r.Lnext.Lnext.Org)&&Ve.vertCCW(r.Lprev.Org,r.Org,i.Lnext.Lnext.Org)&&(n=r.Lnext,this.delete(r),i=null,r=null)),i&&i.Lnext.Org===a)break;i=n}return!0},check:function(){var t,e,i,n,r,a,s=this.fHead,o=this.vHead,l=this.eHead;for(e=s,e=s;(t=e.next)!==s;e=t){Ce(t.prev===e),r=t.anEdge;do Ce(r.Sym!==r),Ce(r.Sym.Sym===r),Ce(r.Lnext.Onext.Sym===r),Ce(r.Onext.Sym.Lnext===r),Ce(r.Lface===t),r=r.Lnext;while(r!==t.anEdge)}for(Ce(t.prev===e&&null===t.anEdge),n=o,n=o;(i=n.next)!==o;n=i){Ce(i.prev===n),r=i.anEdge;do Ce(r.Sym!==r),Ce(r.Sym.Sym===r),Ce(r.Lnext.Onext.Sym===r),Ce(r.Onext.Sym.Lnext===r),Ce(r.Org===i),r=r.Onext;while(r!==i.anEdge)}for(Ce(i.prev===n&&null===i.anEdge),a=l,a=l;(r=a.next)!==l;a=r)Ce(r.Sym.next===a.Sym),Ce(r.Sym!==r),Ce(r.Sym.Sym===r),Ce(null!==r.Org),Ce(null!==r.Dst),Ce(r.Lnext.Onext.Sym===r),Ce(r.Onext.Sym.Lnext===r);Ce(r.Sym.next===a.Sym&&r.Sym===this.eHeadSym&&r.Sym.Sym===r&&null===r.Org&&null===r.Dst&&null===r.Lface&&null===r.Rface)}};var Ve={};Ve.vertEq=function(t,e){return t.s===e.s&&t.t===e.t},Ve.vertLeq=function(t,e){return t.s<e.s||t.s===e.s&&t.t<=e.t},Ve.transLeq=function(t,e){return t.t<e.t||t.t===e.t&&t.s<=e.s},Ve.edgeGoesLeft=function(t){return Ve.vertLeq(t.Dst,t.Org)},Ve.edgeGoesRight=function(t){return Ve.vertLeq(t.Org,t.Dst)},Ve.vertL1dist=function(t,e){return Math.abs(t.s-e.s)+Math.abs(t.t-e.t)},Ve.edgeEval=function(t,e,i){Ce(Ve.vertLeq(t,e)&&Ve.vertLeq(e,i));var n=e.s-t.s,r=i.s-e.s;return n+r>0?n<r?e.t-t.t+(t.t-i.t)*(n/(n+r)):e.t-i.t+(i.t-t.t)*(r/(n+r)):0},Ve.edgeSign=function(t,e,i){Ce(Ve.vertLeq(t,e)&&Ve.vertLeq(e,i));var n=e.s-t.s,r=i.s-e.s;return n+r>0?(e.t-i.t)*n+(e.t-t.t)*r:0},Ve.transEval=function(t,e,i){Ce(Ve.transLeq(t,e)&&Ve.transLeq(e,i));var n=e.t-t.t,r=i.t-e.t;return n+r>0?n<r?e.s-t.s+(t.s-i.s)*(n/(n+r)):e.s-i.s+(i.s-t.s)*(r/(n+r)):0},Ve.transSign=function(t,e,i){Ce(Ve.transLeq(t,e)&&Ve.transLeq(e,i));var n=e.t-t.t,r=i.t-e.t;return n+r>0?(e.s-i.s)*n+(e.s-t.s)*r:0},Ve.vertCCW=function(t,e,i){return t.s*(e.t-i.t)+e.s*(i.t-t.t)+i.s*(t.t-e.t)>=0},Ve.interpolate=function(t,e,i,n){return t=t<0?0:t,i=i<0?0:i,t<=i?0==i?(e+n)/2:e+(n-e)*(t/(t+i)):n+(e-n)*(i/(t+i))},Ve.intersect=function(t,e,i,n,r){var a,s,o;Ve.vertLeq(t,e)||(o=t,t=e,e=o),Ve.vertLeq(i,n)||(o=i,i=n,n=o),Ve.vertLeq(t,i)||(o=t,t=i,i=o,o=e,e=n,n=o),Ve.vertLeq(i,e)?Ve.vertLeq(e,n)?(a=Ve.edgeEval(t,i,e),s=Ve.edgeEval(i,e,n),a+s<0&&(a=-a,s=-s),r.s=Ve.interpolate(a,i.s,s,e.s)):(a=Ve.edgeSign(t,i,e),s=-Ve.edgeSign(t,n,e),
a+s<0&&(a=-a,s=-s),r.s=Ve.interpolate(a,i.s,s,n.s)):r.s=(i.s+e.s)/2,Ve.transLeq(t,e)||(o=t,t=e,e=o),Ve.transLeq(i,n)||(o=i,i=n,n=o),Ve.transLeq(t,i)||(o=t,t=i,i=o,o=e,e=n,n=o),Ve.transLeq(i,e)?Ve.transLeq(e,n)?(a=Ve.transEval(t,i,e),s=Ve.transEval(i,e,n),a+s<0&&(a=-a,s=-s),r.t=Ve.interpolate(a,i.t,s,e.t)):(a=Ve.transSign(t,i,e),s=-Ve.transSign(t,n,e),a+s<0&&(a=-a,s=-s),r.t=Ve.interpolate(a,i.t,s,n.t)):r.t=(i.t+e.t)/2},S.prototype={min:function(){return this.head.next},max:function(){return this.head.prev},insert:function(t){return this.insertBefore(this.head,t)},search:function(t){var e=this.head;do e=e.next;while(null!==e.key&&!this.leq(this.frame,t,e.key));return e},insertBefore:function(t,e){do t=t.prev;while(null!==t.key&&!this.leq(this.frame,t.key,e));var i=new A;return i.key=e,i.next=t.next,t.next.prev=i,i.prev=t,t.next=i,i},delete:function(t){t.next.prev=t.prev,t.prev.next=t.next}},O.prototype={floatDown_:function(t){var e,i,n,r=this.nodes,a=this.handles;for(e=r[t].handle;;){if(n=t<<1,n<this.size&&this.leq(a[r[n+1].handle].key,a[r[n].handle].key)&&++n,Ce(n<=this.max),i=r[n].handle,n>this.size||this.leq(a[e].key,a[i].key)){r[t].handle=e,a[e].node=t;break}r[t].handle=i,a[i].node=t,t=n}},floatUp_:function(t){var e,i,n,r=this.nodes,a=this.handles;for(e=r[t].handle;;){if(n=t>>1,i=r[n].handle,0==n||this.leq(a[i].key,a[e].key)){r[t].handle=e,a[e].node=t;break}r[t].handle=i,a[i].node=t,t=n}},init:function(){for(var t=this.size;t>=1;--t)this.floatDown_(t);this.initialized=!0},min:function(){return this.handles[this.nodes[1].handle].key},isEmpty:function(){0===this.size},insert:function(t){var e,i;if(e=++this.size,2*e>this.max){this.max*=2;var n;n=this.nodes.length,this.nodes.length=this.max+1;for(var r=n;r<this.nodes.length;r++)this.nodes[r]=new R;n=this.handles.length,this.handles.length=this.max+1;for(var r=n;r<this.handles.length;r++)this.handles[r]=new E}return 0===this.freeList?i=e:(i=this.freeList,this.freeList=this.handles[i].node),this.nodes[e].handle=i,this.handles[i].node=e,this.handles[i].key=t,this.initialized&&this.floatUp_(e),i},extractMin:function(){var t=this.nodes,e=this.handles,i=t[1].handle,n=e[i].key;return this.size>0&&(t[1].handle=t[this.size].handle,e[t[1].handle].node=1,e[i].key=null,e[i].node=this.freeList,this.freeList=i,--this.size,this.size>0&&this.floatDown_(1)),n},delete:function(t){var e,i=this.nodes,n=this.handles;Ce(t>=1&&t<=this.max&&null!==n[t].key),e=n[t].node,i[e].handle=i[this.size].handle,n[i[e].handle].node=e,--this.size,e<=this.size&&(e<=1||this.leq(n[i[e>>1].handle].key,n[i[e].handle].key)?this.floatDown_(e):this.floatUp_(e)),n[t].key=null,n[t].node=this.freeList,this.freeList=t}};var Fe={};Fe.regionBelow=function(t){return t.nodeUp.prev.key},Fe.regionAbove=function(t){return t.nodeUp.next.key},Fe.debugEvent=function(t){},Fe.addWinding=function(t,e){t.winding+=e.winding,t.Sym.winding+=e.Sym.winding},Fe.edgeLeq=function(t,e,i){var n,r,a=t.event,s=e.eUp,o=i.eUp;if(s.Dst===a)return o.Dst===a?Ve.vertLeq(s.Org,o.Org)?Ve.edgeSign(o.Dst,s.Org,o.Org)<=0:Ve.edgeSign(s.Dst,o.Org,s.Org)>=0:Ve.edgeSign(o.Dst,a,o.Org)<=0;if(o.Dst===a)return Ve.edgeSign(s.Dst,a,s.Org)>=0;var n=Ve.edgeEval(s.Dst,a,s.Org),r=Ve.edgeEval(o.Dst,a,o.Org);return n>=r},Fe.deleteRegion=function(t,e){e.fixUpperEdge&&Ce(0===e.eUp.winding),e.eUp.activeRegion=null,t.dict.delete(e.nodeUp)},Fe.fixUpperEdge=function(t,e,i){Ce(e.fixUpperEdge),t.mesh.delete(e.eUp),e.fixUpperEdge=!1,e.eUp=i,i.activeRegion=e},Fe.topLeftRegion=function(t,e){var i,n=e.eUp.Org;do e=Fe.regionAbove(e);while(e.eUp.Org===n);if(e.fixUpperEdge){if(i=t.mesh.connect(Fe.regionBelow(e).eUp.Sym,e.eUp.Lnext),null===i)return null;Fe.fixUpperEdge(t,e,i),e=Fe.regionAbove(e)}return e},Fe.topRightRegion=function(t){var e=t.eUp.Dst,t=null;do t=Fe.regionAbove(t);while(t.eUp.Dst===e);return t},Fe.addRegionBelow=function(t,e,i){var n=new w;return n.eUp=i,n.nodeUp=t.dict.insertBefore(e.nodeUp,n),n.fixUpperEdge=!1,n.sentinel=!1,n.dirty=!1,i.activeRegion=n,n},Fe.isWindingInside=function(t,e){switch(t.windingRule){case Te.WINDING_ODD:return 0!=(1&e);case Te.WINDING_NONZERO:return 0!=e;case Te.WINDING_POSITIVE:return e>0;case Te.WINDING_NEGATIVE:return e<0;case Te.WINDING_ABS_GEQ_TWO:return e>=2||e<=-2}return Ce(!1),!1},Fe.computeWinding=function(t,e){e.windingNumber=Fe.regionAbove(e).windingNumber+e.eUp.winding,e.inside=Fe.isWindingInside(t,e.windingNumber)},Fe.finishRegion=function(t,e){var i=e.eUp,n=i.Lface;n.inside=e.inside,n.anEdge=i,Fe.deleteRegion(t,e)},Fe.finishLeftRegions=function(t,e,i){for(var n,r,a=null,s=e,r=e.eUp;s!==i;){if(s.fixUpperEdge=!1,a=Fe.regionBelow(s),n=a.eUp,n.Org!=r.Org){if(!a.fixUpperEdge){Fe.finishRegion(t,s);break}n=t.mesh.connect(r.Lprev,n.Sym),Fe.fixUpperEdge(t,a,n)}r.Onext!==n&&(t.mesh.splice(n.Oprev,n),t.mesh.splice(r,n)),Fe.finishRegion(t,s),r=a.eUp,s=a}return r},Fe.addRightEdges=function(t,e,i,n,r,a){var s,o,l,h,c=!0;l=i;do Ce(Ve.vertLeq(l.Org,l.Dst)),Fe.addRegionBelow(t,e,l.Sym),l=l.Onext;while(l!==n);for(null===r&&(r=Fe.regionBelow(e).eUp.Rprev),o=e,h=r;s=Fe.regionBelow(o),l=s.eUp.Sym,l.Org===h.Org;)l.Onext!==h&&(t.mesh.splice(l.Oprev,l),t.mesh.splice(h.Oprev,l)),s.windingNumber=o.windingNumber-l.winding,s.inside=Fe.isWindingInside(t,s.windingNumber),o.dirty=!0,!c&&Fe.checkForRightSplice(t,o)&&(Fe.addWinding(l,h),Fe.deleteRegion(t,o),t.mesh.delete(h)),c=!1,o=s,h=l;o.dirty=!0,Ce(o.windingNumber-l.winding===s.windingNumber),a&&Fe.walkDirtyRegions(t,o)},Fe.spliceMergeVertices=function(t,e,i){t.mesh.splice(e,i)},Fe.vertexWeights=function(t,e,i){var n=Ve.vertL1dist(e,t),r=Ve.vertL1dist(i,t),a=.5*r/(n+r),s=.5*n/(n+r);t.coords[0]+=a*e.coords[0]+s*i.coords[0],t.coords[1]+=a*e.coords[1]+s*i.coords[1],t.coords[2]+=a*e.coords[2]+s*i.coords[2]},Fe.getIntersectData=function(t,e,i,n,r,a){e.coords[0]=e.coords[1]=e.coords[2]=0,e.idx=-1,Fe.vertexWeights(e,i,n),Fe.vertexWeights(e,r,a)},Fe.checkForRightSplice=function(t,e){var i=Fe.regionBelow(e),n=e.eUp,r=i.eUp;if(Ve.vertLeq(n.Org,r.Org)){if(Ve.edgeSign(r.Dst,n.Org,r.Org)>0)return!1;Ve.vertEq(n.Org,r.Org)?n.Org!==r.Org&&(t.pq.delete(n.Org.pqHandle),Fe.spliceMergeVertices(t,r.Oprev,n)):(t.mesh.splitEdge(r.Sym),t.mesh.splice(n,r.Oprev),e.dirty=i.dirty=!0)}else{if(Ve.edgeSign(n.Dst,r.Org,n.Org)<0)return!1;Fe.regionAbove(e).dirty=e.dirty=!0,t.mesh.splitEdge(n.Sym),t.mesh.splice(r.Oprev,n)}return!0},Fe.checkForLeftSplice=function(t,e){var i,n=Fe.regionBelow(e),r=e.eUp,a=n.eUp;if(Ce(!Ve.vertEq(r.Dst,a.Dst)),Ve.vertLeq(r.Dst,a.Dst)){if(Ve.edgeSign(r.Dst,a.Dst,r.Org)<0)return!1;Fe.regionAbove(e).dirty=e.dirty=!0,i=t.mesh.splitEdge(r),t.mesh.splice(a.Sym,i),i.Lface.inside=e.inside}else{if(Ve.edgeSign(a.Dst,r.Dst,a.Org)>0)return!1;e.dirty=n.dirty=!0,i=t.mesh.splitEdge(a),t.mesh.splice(r.Lnext,a.Sym),i.Rface.inside=e.inside}return!0},Fe.checkForIntersect=function(t,e){var i,n,r,a,s=Fe.regionBelow(e),o=e.eUp,l=s.eUp,h=o.Org,c=l.Org,u=o.Dst,f=l.Dst,d=new m;if(Ce(!Ve.vertEq(f,u)),Ce(Ve.edgeSign(u,t.event,h)<=0),Ce(Ve.edgeSign(f,t.event,c)>=0),Ce(h!==t.event&&c!==t.event),Ce(!e.fixUpperEdge&&!s.fixUpperEdge),h===c)return!1;if(i=Math.min(h.t,u.t),n=Math.max(c.t,f.t),i>n)return!1;if(Ve.vertLeq(h,c)){if(Ve.edgeSign(f,h,c)>0)return!1}else if(Ve.edgeSign(u,c,h)<0)return!1;return Fe.debugEvent(t),Ve.intersect(u,h,f,c,d),Ce(Math.min(h.t,u.t)<=d.t),Ce(d.t<=Math.max(c.t,f.t)),Ce(Math.min(f.s,u.s)<=d.s),Ce(d.s<=Math.max(c.s,h.s)),Ve.vertLeq(d,t.event)&&(d.s=t.event.s,d.t=t.event.t),r=Ve.vertLeq(h,c)?h:c,Ve.vertLeq(r,d)&&(d.s=r.s,d.t=r.t),Ve.vertEq(d,h)||Ve.vertEq(d,c)?(Fe.checkForRightSplice(t,e),!1):!Ve.vertEq(u,t.event)&&Ve.edgeSign(u,t.event,d)>=0||!Ve.vertEq(f,t.event)&&Ve.edgeSign(f,t.event,d)<=0?f===t.event?(t.mesh.splitEdge(o.Sym),t.mesh.splice(l.Sym,o),e=Fe.topLeftRegion(t,e),o=Fe.regionBelow(e).eUp,Fe.finishLeftRegions(t,Fe.regionBelow(e),s),Fe.addRightEdges(t,e,o.Oprev,o,o,!0),TRUE):u===t.event?(t.mesh.splitEdge(l.Sym),t.mesh.splice(o.Lnext,l.Oprev),s=e,e=Fe.topRightRegion(e),a=Fe.regionBelow(e).eUp.Rprev,s.eUp=l.Oprev,l=Fe.finishLeftRegions(t,s,null),Fe.addRightEdges(t,e,l.Onext,o.Rprev,a,!0),!0):(Ve.edgeSign(u,t.event,d)>=0&&(Fe.regionAbove(e).dirty=e.dirty=!0,t.mesh.splitEdge(o.Sym),o.Org.s=t.event.s,o.Org.t=t.event.t),Ve.edgeSign(f,t.event,d)<=0&&(e.dirty=s.dirty=!0,t.mesh.splitEdge(l.Sym),l.Org.s=t.event.s,l.Org.t=t.event.t),!1):(t.mesh.splitEdge(o.Sym),t.mesh.splitEdge(l.Sym),t.mesh.splice(l.Oprev,o),o.Org.s=d.s,o.Org.t=d.t,o.Org.pqHandle=t.pq.insert(o.Org),Fe.getIntersectData(t,o.Org,h,u,c,f),Fe.regionAbove(e).dirty=e.dirty=s.dirty=!0,!1)},Fe.walkDirtyRegions=function(t,e){for(var i,n,r=Fe.regionBelow(e);;){for(;r.dirty;)e=r,r=Fe.regionBelow(r);if(!e.dirty&&(r=e,e=Fe.regionAbove(e),null==e||!e.dirty))return;if(e.dirty=!1,i=e.eUp,n=r.eUp,i.Dst!==n.Dst&&Fe.checkForLeftSplice(t,e)&&(r.fixUpperEdge?(Fe.deleteRegion(t,r),t.mesh.delete(n),r=Fe.regionBelow(e),n=r.eUp):e.fixUpperEdge&&(Fe.deleteRegion(t,e),t.mesh.delete(i),e=Fe.regionAbove(r),i=e.eUp)),i.Org!==n.Org)if(i.Dst===n.Dst||e.fixUpperEdge||r.fixUpperEdge||i.Dst!==t.event&&n.Dst!==t.event)Fe.checkForRightSplice(t,e);else if(Fe.checkForIntersect(t,e))return;i.Org===n.Org&&i.Dst===n.Dst&&(Fe.addWinding(n,i),Fe.deleteRegion(t,e),t.mesh.delete(i),e=Fe.regionAbove(r))}},Fe.connectRightVertex=function(t,e,i){var n,r=i.Onext,a=Fe.regionBelow(e),s=e.eUp,o=a.eUp,l=!1;return s.Dst!==o.Dst&&Fe.checkForIntersect(t,e),Ve.vertEq(s.Org,t.event)&&(t.mesh.splice(r.Oprev,s),e=Fe.topLeftRegion(t,e),r=Fe.regionBelow(e).eUp,Fe.finishLeftRegions(t,Fe.regionBelow(e),a),l=!0),Ve.vertEq(o.Org,t.event)&&(t.mesh.splice(i,o.Oprev),i=Fe.finishLeftRegions(t,a,null),l=!0),l?void Fe.addRightEdges(t,e,i.Onext,r,r,!0):(n=Ve.vertLeq(o.Org,s.Org)?o.Oprev:s,n=t.mesh.connect(i.Lprev,n),Fe.addRightEdges(t,e,n,n.Onext,n.Onext,!1),n.Sym.activeRegion.fixUpperEdge=!0,void Fe.walkDirtyRegions(t,e))},Fe.connectLeftDegenerate=function(t,e,i){var n,r,a,s,o;return n=e.eUp,Ve.vertEq(n.Org,i)?(Ce(!1),void Fe.spliceMergeVertices(t,n,i.anEdge)):Ve.vertEq(n.Dst,i)?(Ce(!1),e=Fe.topRightRegion(e),o=Fe.regionBelow(e),a=o.eUp.Sym,r=s=a.Onext,o.fixUpperEdge&&(Ce(r!==a),Fe.deleteRegion(t,o),t.mesh.delete(a),a=r.Oprev),t.mesh.splice(i.anEdge,a),Ve.edgeGoesLeft(r)||(r=null),void Fe.addRightEdges(t,e,a.Onext,s,r,!0)):(t.mesh.splitEdge(n.Sym),e.fixUpperEdge&&(t.mesh.delete(n.Onext),e.fixUpperEdge=!1),t.mesh.splice(i.anEdge,n),void Fe.sweepEvent(t,i))},Fe.connectLeftVertex=function(t,e){var i,n,r,a,s,o,l=new w;if(l.eUp=e.anEdge.Sym,i=t.dict.search(l).key,n=Fe.regionBelow(i)){if(a=i.eUp,s=n.eUp,0===Ve.edgeSign(a.Dst,e,a.Org))return void Fe.connectLeftDegenerate(t,i,e);if(r=Ve.vertLeq(s.Dst,a.Dst)?i:n,i.inside||r.fixUpperEdge){if(r===i)o=t.mesh.connect(e.anEdge.Sym,a.Lnext);else{var h=t.mesh.connect(s.Dnext,e.anEdge);o=h.Sym}r.fixUpperEdge?Fe.fixUpperEdge(t,r,o):Fe.computeWinding(t,Fe.addRegionBelow(t,i,o)),Fe.sweepEvent(t,e)}else Fe.addRightEdges(t,i,e.anEdge,e.anEdge,null,!0)}},Fe.sweepEvent=function(t,e){t.event=e,Fe.debugEvent(t);for(var i=e.anEdge;null===i.activeRegion;)if(i=i.Onext,i==e.anEdge)return void Fe.connectLeftVertex(t,e);var n=Fe.topLeftRegion(t,i.activeRegion);Ce(null!==n);var r=Fe.regionBelow(n),a=r.eUp,s=Fe.finishLeftRegions(t,r,null);s.Onext===a?Fe.connectRightVertex(t,n,s):Fe.addRightEdges(t,n,s.Onext,a,a,!0)},Fe.addSentinel=function(t,e,i,n){var r=new w,a=t.mesh.makeEdge();a.Org.s=i,a.Org.t=n,a.Dst.s=e,a.Dst.t=n,t.event=a.Dst,r.eUp=a,r.windingNumber=0,r.inside=!1,r.fixUpperEdge=!1,r.sentinel=!0,r.dirty=!1,r.nodeUp=t.dict.insert(r)},Fe.initEdgeDict=function(t){t.dict=new S(t,Fe.edgeLeq);var e=t.bmax[0]-t.bmin[0],i=t.bmax[1]-t.bmin[1],n=t.bmin[0]-e,r=t.bmax[0]+e,a=t.bmin[1]-i,s=t.bmax[1]+i;Fe.addSentinel(t,n,r,a),Fe.addSentinel(t,n,r,s)},Fe.doneEdgeDict=function(t){for(var e,i=0;null!==(e=t.dict.min().key);)e.sentinel||(Ce(e.fixUpperEdge),Ce(1==++i)),Ce(0==e.windingNumber),Fe.deleteRegion(t,e)},Fe.removeDegenerateEdges=function(t){var e,i,n,r=t.mesh.eHead;for(e=r.next;e!==r;e=i)i=e.next,n=e.Lnext,Ve.vertEq(e.Org,e.Dst)&&e.Lnext.Lnext!==e&&(Fe.spliceMergeVertices(t,n,e),t.mesh.delete(e),e=n,n=e.Lnext),n.Lnext===e&&(n!==e&&(n!==i&&n!==i.Sym||(i=i.next),t.mesh.delete(n)),e!==i&&e!==i.Sym||(i=i.next),t.mesh.delete(e))},Fe.initPriorityQ=function(t){var e,i,n,r=0;for(n=t.mesh.vHead,i=n.next;i!==n;i=i.next)r++;for(r+=8,e=t.pq=new O(r,Ve.vertLeq),n=t.mesh.vHead,i=n.next;i!==n;i=i.next)i.pqHandle=e.insert(i);return i===n&&(e.init(),!0)},Fe.donePriorityQ=function(t){t.pq=null},Fe.removeDegenerateFaces=function(t,e){var i,n,r;for(i=e.fHead.next;i!==e.fHead;i=n)n=i.next,r=i.anEdge,Ce(r.Lnext!==r),r.Lnext.Lnext===r&&(Fe.addWinding(r.Onext,r),t.mesh.delete(r));return!0},Fe.computeInterior=function(t){var e,i;if(Fe.removeDegenerateEdges(t),!Fe.initPriorityQ(t))return!1;for(Fe.initEdgeDict(t);null!==(e=t.pq.extractMin());){for(;i=t.pq.min(),null!==i&&Ve.vertEq(i,e);)i=t.pq.extractMin(),Fe.spliceMergeVertices(t,e.anEdge,i.anEdge);Fe.sweepEvent(t,e)}return t.event=t.dict.min().key.eUp.Org,Fe.debugEvent(t),Fe.doneEdgeDict(t),Fe.donePriorityQ(t),!!Fe.removeDegenerateFaces(t,t.mesh)&&(t.mesh.check(),!0)},T.prototype={dot_:function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},normalize_:function(t){var e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];Ce(e>0),e=Math.sqrt(e),t[0]/=e,t[1]/=e,t[2]/=e},longAxis_:function(t){var e=0;return Math.abs(t[1])>Math.abs(t[0])&&(e=1),Math.abs(t[2])>Math.abs(t[e])&&(e=2),e},computeNormal_:function(t){var e,i,n,r,a,s,o,l=[0,0,0],h=[0,0,0],c=[0,0,0],u=[0,0,0],f=[0,0,0],d=[null,null,null],_=[null,null,null],p=this.mesh.vHead;for(e=p.next,o=0;o<3;++o)r=e.coords[o],h[o]=r,_[o]=e,l[o]=r,d[o]=e;for(e=p.next;e!==p;e=e.next)for(o=0;o<3;++o)r=e.coords[o],r<h[o]&&(h[o]=r,_[o]=e),r>l[o]&&(l[o]=r,d[o]=e);if(o=0,l[1]-h[1]>l[0]-h[0]&&(o=1),l[2]-h[2]>l[o]-h[o]&&(o=2),h[o]>=l[o])return t[0]=0,t[1]=0,void(t[2]=1);for(s=0,i=_[o],n=d[o],c[0]=i.coords[0]-n.coords[0],c[1]=i.coords[1]-n.coords[1],c[2]=i.coords[2]-n.coords[2],e=p.next;e!==p;e=e.next)u[0]=e.coords[0]-n.coords[0],u[1]=e.coords[1]-n.coords[1],u[2]=e.coords[2]-n.coords[2],f[0]=c[1]*u[2]-c[2]*u[1],f[1]=c[2]*u[0]-c[0]*u[2],f[2]=c[0]*u[1]-c[1]*u[0],a=f[0]*f[0]+f[1]*f[1]+f[2]*f[2],a>s&&(s=a,t[0]=f[0],t[1]=f[1],t[2]=f[2]);s<=0&&(t[0]=t[1]=t[2]=0,t[this.longAxis_(c)]=1)},checkOrientation_:function(){var t,e,i,n,r=this.mesh.fHead,a=this.mesh.vHead;for(t=0,e=r.next;e!==r;e=e.next)if(n=e.anEdge,!(n.winding<=0))do t+=(n.Org.s-n.Dst.s)*(n.Org.t+n.Dst.t),n=n.Lnext;while(n!==e.anEdge);if(t<0){for(i=a.next;i!==a;i=i.next)i.t=-i.t;this.tUnit[0]=-this.tUnit[0],this.tUnit[1]=-this.tUnit[1],this.tUnit[2]=-this.tUnit[2]}},projectPolygon_:function(){var t,e,i,n,r,a=this.mesh.vHead,s=[0,0,0],o=!1;for(s[0]=this.normal[0],s[1]=this.normal[1],s[2]=this.normal[2],0===s[0]&&0===s[1]&&0===s[2]&&(this.computeNormal_(s),o=!0),e=this.sUnit,i=this.tUnit,n=this.longAxis_(s),e[n]=0,e[(n+1)%3]=1,e[(n+2)%3]=0,i[n]=0,i[(n+1)%3]=0,i[(n+2)%3]=s[n]>0?1:-1,t=a.next;t!==a;t=t.next)t.s=this.dot_(t.coords,e),t.t=this.dot_(t.coords,i);for(o&&this.checkOrientation_(),r=!0,t=a.next;t!==a;t=t.next)r?(this.bmin[0]=this.bmax[0]=t.s,this.bmin[1]=this.bmax[1]=t.t,r=!1):(t.s<this.bmin[0]&&(this.bmin[0]=t.s),t.s>this.bmax[0]&&(this.bmax[0]=t.s),t.t<this.bmin[1]&&(this.bmin[1]=t.t),t.t>this.bmax[1]&&(this.bmax[1]=t.t))},addWinding_:function(t,e){t.winding+=e.winding,t.Sym.winding+=e.Sym.winding},tessellateMonoRegion_:function(t,e){var i,n;for(i=e.anEdge,Ce(i.Lnext!==i&&i.Lnext.Lnext!==i);Ve.vertLeq(i.Dst,i.Org);i=i.Lprev);for(;Ve.vertLeq(i.Org,i.Dst);i=i.Lnext);for(n=i.Lprev;i.Lnext!==n;)if(Ve.vertLeq(i.Dst,n.Org)){for(;n.Lnext!==i&&(Ve.edgeGoesLeft(n.Lnext)||Ve.edgeSign(n.Org,n.Dst,n.Lnext.Dst)<=0);){var r=t.connect(n.Lnext,n);n=r.Sym}n=n.Lprev}else{for(;n.Lnext!=i&&(Ve.edgeGoesRight(i.Lprev)||Ve.edgeSign(i.Dst,i.Org,i.Lprev.Org)>=0);){var r=t.connect(i,i.Lprev);i=r.Sym}i=i.Lnext}for(Ce(n.Lnext!==i);n.Lnext.Lnext!==i;){var r=t.connect(n.Lnext,n);n=r.Sym}return!0},tessellateInterior_:function(t){var e,i;for(e=t.fHead.next;e!==t.fHead;e=i)if(i=e.next,e.inside&&!this.tessellateMonoRegion_(t,e))return!1;return!0},discardExterior_:function(t){var e,i;for(e=t.fHead.next;e!==t.fHead;e=i)i=e.next,e.inside||t.zapFace(e)},setWindingNumber_:function(t,e,i){var n,r;for(n=t.eHead.next;n!==t.eHead;n=r)r=n.next,n.Rface.inside!==n.Lface.inside?n.winding=n.Lface.inside?e:-e:i?t.delete(n):n.winding=0},getNeighbourFace_:function(t){return t.Rface&&t.Rface.inside?t.Rface.n:-1},outputPolymesh_:function(t,e,i,n){var r,a,s,o,l,h=0,c=0;for(i>3&&t.mergeConvexFaces(i),r=t.vHead.next;r!==t.vHead;r=r.next)r.n=-1;for(a=t.fHead.next;a!=t.fHead;a=a.next)if(a.n=-1,a.inside){s=a.anEdge,o=0;do r=s.Org,r.n===-1&&(r.n=c,c++),o++,s=s.Lnext;while(s!==a.anEdge);Ce(o<=i),a.n=h,++h}for(this.elementCount=h,e==Te.CONNECTED_POLYGONS&&(h*=2),this.elements=[],this.elements.length=h*i,this.vertexCount=c,this.vertices=[],this.vertices.length=c*n,this.vertexIndices=[],this.vertexIndices.length=c,r=t.vHead.next;r!==t.vHead;r=r.next)if(r.n!=-1){var u=r.n*n;this.vertices[u+0]=r.coords[0],this.vertices[u+1]=r.coords[1],n>2&&(this.vertices[u+2]=r.coords[2]),this.vertexIndices[r.n]=r.idx}var f=0;for(a=t.fHead.next;a!==t.fHead;a=a.next)if(a.inside){s=a.anEdge,o=0;do r=s.Org,this.elements[f++]=r.n,o++,s=s.Lnext;while(s!==a.anEdge);for(l=o;l<i;++l)this.elements[f++]=-1;if(e==Te.CONNECTED_POLYGONS){s=a.anEdge;do this.elements[f++]=this.getNeighbourFace_(s),s=s.Lnext;while(s!==a.anEdge);for(l=o;l<i;++l)this.elements[f++]=-1}}},outputContours_:function(t,e){var i,n,r,a=0,s=0;for(this.vertexCount=0,this.elementCount=0,i=t.fHead.next;i!==t.fHead;i=i.next)if(i.inside){r=n=i.anEdge;do this.vertexCount++,n=n.Lnext;while(n!==r);this.elementCount++}this.elements=[],this.elements.length=2*this.elementCount,this.vertices=[],this.vertices.length=this.vertexCount*e,this.vertexIndices=[],this.vertexIndices.length=this.vertexCount;var o=0,l=0,h=0;for(a=0,i=t.fHead.next;i!==t.fHead;i=i.next)if(i.inside){s=0,r=n=i.anEdge;do this.vertices[o++]=n.Org.coords[0],this.vertices[o++]=n.Org.coords[1],e>2&&(this.vertices[o++]=n.Org.coords[2]),this.vertexIndices[l++]=n.Org.idx,s++,n=n.Lnext;while(n!==r);this.elements[h++]=a,this.elements[h++]=s,a+=s}},addContour:function(t,e){var i,n;for(null===this.mesh&&(this.mesh=new L),t<2&&(t=2),t>3&&(t=3),i=null,n=0;n<e.length;n+=t)null==i?(i=this.mesh.makeEdge(),this.mesh.splice(i,i.Sym)):(this.mesh.splitEdge(i),i=i.Lnext),i.Org.coords[0]=e[n+0],i.Org.coords[1]=e[n+1],t>2?i.Org.coords[2]=e[n+2]:i.Org.coords[2]=0,i.Org.idx=this.vertexIndexCounter++,i.winding=1,i.Sym.winding=-1},tesselate:function(t,e,i,n,r){if(this.vertices=[],this.elements=[],this.vertexIndices=[],this.vertexIndexCounter=0,r&&(this.normal[0]=r[0],this.normal[1]=r[1],this.normal[2]=r[2]),this.windingRule=t,n<2&&(n=2),n>3&&(n=3),!this.mesh)return!1;this.projectPolygon_(),Fe.computeInterior(this);var a=this.mesh;return e==Te.BOUNDARY_CONTOURS?this.setWindingNumber_(a,1,!0):this.tessellateInterior_(a),a.check(),e==Te.BOUNDARY_CONTOURS?this.outputContours_(a,n):this.outputPolymesh_(a,e,i,n),!0}};var De=ke,Be=k,Ue=Object.prototype.hasOwnProperty,Me=De,Pe=Be,qe=function(t,e){if(e=e||{},t=t.filter(function(t){return t.length>0}),0===t.length)return{positions:[],cells:[]};"number"!=typeof e.vertexSize&&(e.vertexSize=t[0][0].length),t=t.map(function(t){return t.reduce(function(t,e){return t.concat(e)})});for(var i=Me.tesselate(Pe({contours:t,windingRule:Me.WINDING_ODD,elementType:Me.POLYGONS,polySize:3,vertexSize:2},e)),n=[],r=0;r<i.vertices.length;r+=e.vertexSize){var a=i.vertices.slice(r,r+e.vertexSize);n.push(a)}var s=[];for(r=0;r<i.elements.length;r+=3){var o=i.elements[r],l=i.elements[r+1],h=i.elements[r+2];s.push([o,l,h])}return{positions:n,cells:s}},ze=function(t,e,i){var n=e;if(t._pathCache[n])return t._pathCacheHit++,t._pathCache[n];if(t._pathCacheMiss++,i=i||1,!e)return{lines:[],triangles:[],closed:!1,z:0};var r,a=we(ne(e));a=a.map(function(t){return ue(t,i)});try{r=qe(a)}catch(t){r={positions:[],cells:[]}}for(var s=t._randomZ?.25*(Math.random()-.5):0,o=[],l=r.cells.length,h=r.cells,c=r.positions,u=0;u<l;u++){var f=h[u],d=c[f[0]],_=c[f[1]],p=c[f[2]];o.push(d[0],d[1],s,_[0],_[1],s,p[0],p[1],s)}var g={lines:a,triangles:o,closed:e.endsWith("Z"),z:s,key:n};return t._pathCache[n]=g,t._pathCacheSize++,t._pathCacheSize>1e4&&(t._pathCache={},t._pathCacheSize=0),g},Ie=Math.PI,Ne=2*Ie,We=1e-6,He=Ne-We;C.prototype=V.prototype={constructor:C,moveTo:function(t,e){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)},closePath:function(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(t,e){this._+="L"+(this._x1=+t)+","+(this._y1=+e)},quadraticCurveTo:function(t,e,i,n){this._+="Q"+ +t+","+ +e+","+(this._x1=+i)+","+(this._y1=+n)},bezierCurveTo:function(t,e,i,n,r,a){this._+="C"+ +t+","+ +e+","+ +i+","+ +n+","+(this._x1=+r)+","+(this._y1=+a)},arcTo:function(t,e,i,n,r){t=+t,e=+e,i=+i,n=+n,r=+r;var a=this._x1,s=this._y1,o=i-t,l=n-e,h=a-t,c=s-e,u=h*h+c*c;if(r<0)throw new Error("negative radius: "+r);if(null===this._x1)this._+="M"+(this._x1=t)+","+(this._y1=e);else if(u>We)if(Math.abs(c*o-l*h)>We&&r){var f=i-a,d=n-s,_=o*o+l*l,p=f*f+d*d,g=Math.sqrt(_),v=Math.sqrt(u),x=r*Math.tan((Ie-Math.acos((_+u-p)/(2*g*v)))/2),m=x/v,y=x/g;Math.abs(m-1)>We&&(this._+="L"+(t+m*h)+","+(e+m*c)),this._+="A"+r+","+r+",0,0,"+ +(c*f>h*d)+","+(this._x1=t+y*o)+","+(this._y1=e+y*l)}else this._+="L"+(this._x1=t)+","+(this._y1=e);else;},arc:function(t,e,i,n,r,a){t=+t,e=+e,i=+i;var s=i*Math.cos(n),o=i*Math.sin(n),l=t+s,h=e+o,c=1^a,u=a?n-r:r-n;if(i<0)throw new Error("negative radius: "+i);null===this._x1?this._+="M"+l+","+h:(Math.abs(this._x1-l)>We||Math.abs(this._y1-h)>We)&&(this._+="L"+l+","+h),i&&(u>He?this._+="A"+i+","+i+",0,1,"+c+","+(t-s)+","+(e-o)+"A"+i+","+i+",0,1,"+c+","+(this._x1=l)+","+(this._y1=h):(u<0&&(u=u%Ne+Ne),this._+="A"+i+","+i+",0,"+ +(u>=Ie)+","+c+","+(this._x1=t+i*Math.cos(r))+","+(this._y1=e+i*Math.sin(r))))},rect:function(t,e,i,n){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)+"h"+ +i+"v"+ +n+"h"+-i+"Z"},toString:function(){return this._}};var Ye=function(t){return function(){return t}},Ge=1e-12,je=Math.PI,Xe=je/2,Ze=2*je,Qe=function(){function t(){var t,h,c=+e.apply(this,arguments),u=+i.apply(this,arguments),f=a.apply(this,arguments)-Xe,d=s.apply(this,arguments)-Xe,_=Math.abs(d-f),p=d>f;if(l||(l=t=V()),u<c&&(h=u,u=c,c=h),u>Ge)if(_>Ze-Ge)l.moveTo(u*Math.cos(f),u*Math.sin(f)),l.arc(0,0,u,f,d,!p),c>Ge&&(l.moveTo(c*Math.cos(d),c*Math.sin(d)),l.arc(0,0,c,d,f,p));else{var g,v,x=f,m=d,y=f,b=d,L=_,A=_,S=o.apply(this,arguments)/2,R=S>Ge&&(r?+r.apply(this,arguments):Math.sqrt(c*c+u*u)),E=Math.min(Math.abs(u-c)/2,+n.apply(this,arguments)),O=E,w=E;if(R>Ge){var T=P(R/c*Math.sin(S)),k=P(R/u*Math.sin(S));(L-=2*T)>Ge?(T*=p?1:-1,y+=T,b-=T):(L=0,y=b=(f+d)/2),(A-=2*k)>Ge?(k*=p?1:-1,x+=k,m-=k):(A=0,x=m=(f+d)/2)}var C=u*Math.cos(x),F=u*Math.sin(x),D=c*Math.cos(b),B=c*Math.sin(b);if(E>Ge){var U=u*Math.cos(m),M=u*Math.sin(m),I=c*Math.cos(y),N=c*Math.sin(y);if(_<je){var W=L>Ge?q(C,F,I,N,U,M,D,B):[D,B],H=C-W[0],Y=F-W[1],G=U-W[0],j=M-W[1],X=1/Math.sin(Math.acos((H*G+Y*j)/(Math.sqrt(H*H+Y*Y)*Math.sqrt(G*G+j*j)))/2),Z=Math.sqrt(W[0]*W[0]+W[1]*W[1]);O=Math.min(E,(c-Z)/(X-1)),w=Math.min(E,(u-Z)/(X+1))}}A>Ge?w>Ge?(g=z(I,N,C,F,u,w,p),v=z(U,M,D,B,u,w,p),l.moveTo(g.cx+g.x01,g.cy+g.y01),w<E?l.arc(g.cx,g.cy,w,Math.atan2(g.y01,g.x01),Math.atan2(v.y01,v.x01),!p):(l.arc(g.cx,g.cy,w,Math.atan2(g.y01,g.x01),Math.atan2(g.y11,g.x11),!p),l.arc(0,0,u,Math.atan2(g.cy+g.y11,g.cx+g.x11),Math.atan2(v.cy+v.y11,v.cx+v.x11),!p),l.arc(v.cx,v.cy,w,Math.atan2(v.y11,v.x11),Math.atan2(v.y01,v.x01),!p))):(l.moveTo(C,F),l.arc(0,0,u,x,m,!p)):l.moveTo(C,F),c>Ge&&L>Ge?O>Ge?(g=z(D,B,U,M,c,-O,p),v=z(C,F,I,N,c,-O,p),l.lineTo(g.cx+g.x01,g.cy+g.y01),O<E?l.arc(g.cx,g.cy,O,Math.atan2(g.y01,g.x01),Math.atan2(v.y01,v.x01),!p):(l.arc(g.cx,g.cy,O,Math.atan2(g.y01,g.x01),Math.atan2(g.y11,g.x11),!p),l.arc(0,0,c,Math.atan2(g.cy+g.y11,g.cx+g.x11),Math.atan2(v.cy+v.y11,v.cx+v.x11),p),l.arc(v.cx,v.cy,O,Math.atan2(v.y11,v.x11),Math.atan2(v.y01,v.x01),!p))):l.arc(0,0,c,b,y,p):l.lineTo(D,B)}else l.moveTo(0,0);if(l.closePath(),t)return l=null,t+""||null}var e=F,i=D,n=Ye(0),r=null,a=B,s=U,o=M,l=null;return t.centroid=function(){var t=(+e.apply(this,arguments)+ +i.apply(this,arguments))/2,n=(+a.apply(this,arguments)+ +s.apply(this,arguments))/2-je/2;return[Math.cos(n)*t,Math.sin(n)*t]},t.innerRadius=function(i){return arguments.length?(e="function"==typeof i?i:Ye(+i),t):e},t.outerRadius=function(e){return arguments.length?(i="function"==typeof e?e:Ye(+e),t):i},t.cornerRadius=function(e){return arguments.length?(n="function"==typeof e?e:Ye(+e),t):n},t.padRadius=function(e){return arguments.length?(r=null==e?null:"function"==typeof e?e:Ye(+e),t):r},t.startAngle=function(e){return arguments.length?(a="function"==typeof e?e:Ye(+e),t):a},t.endAngle=function(e){return arguments.length?(s="function"==typeof e?e:Ye(+e),t):s},t.padAngle=function(e){return arguments.length?(o="function"==typeof e?e:Ye(+e),t):o},t.context=function(e){return arguments.length?(l=null==e?null:e,t):l},t};I.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:this._context.lineTo(t,e)}}};var Je=function(t){return new I(t)},Ke=function(){function t(t){var o,l,h,c=t.length,u=!1;for(null==r&&(s=a(h=V())),o=0;o<=c;++o)!(o<c&&n(l=t[o],o,t))===u&&((u=!u)?s.lineStart():s.lineEnd()),u&&s.point(+e(l,o,t),+i(l,o,t));if(h)return s=null,h+""||null}var e=N,i=W,n=Ye(!0),r=null,a=Je,s=null;return t.x=function(i){return arguments.length?(e="function"==typeof i?i:Ye(+i),t):e},t.y=function(e){return arguments.length?(i="function"==typeof e?e:Ye(+e),t):i},t.defined=function(e){return arguments.length?(n="function"==typeof e?e:Ye(!!e),t):n},t.curve=function(e){return arguments.length?(a=e,null!=r&&(s=a(r)),t):a},t.context=function(e){return arguments.length?(null==e?r=s=null:s=a(r=e),t):r},t},$e=function(){function t(t){var e,c,u,f,d,_=t.length,p=!1,g=new Array(_),v=new Array(_);for(null==o&&(h=l(d=V())),e=0;e<=_;++e){if(!(e<_&&s(f=t[e],e,t))===p)if(p=!p)c=e,h.areaStart(),h.lineStart();else{for(h.lineEnd(),h.lineStart(),u=e-1;u>=c;--u)h.point(g[u],v[u]);h.lineEnd(),h.areaEnd()}p&&(g[e]=+i(f,e,t),v[e]=+r(f,e,t),h.point(n?+n(f,e,t):g[e],a?+a(f,e,t):v[e]))}if(d)return h=null,d+""||null}function e(){return Ke().defined(s).curve(l).context(o)}var i=N,n=null,r=Ye(0),a=W,s=Ye(!0),o=null,l=Je,h=null;return t.x=function(e){return arguments.length?(i="function"==typeof e?e:Ye(+e),n=null,t):i},t.x0=function(e){return arguments.length?(i="function"==typeof e?e:Ye(+e),t):i},t.x1=function(e){return arguments.length?(n=null==e?null:"function"==typeof e?e:Ye(+e),t):n},t.y=function(e){return arguments.length?(r="function"==typeof e?e:Ye(+e),a=null,t):r},t.y0=function(e){return arguments.length?(r="function"==typeof e?e:Ye(+e),t):r},t.y1=function(e){return arguments.length?(a=null==e?null:"function"==typeof e?e:Ye(+e),t):a},t.lineX0=t.lineY0=function(){return e().x(i).y(r)},t.lineY1=function(){return e().x(i).y(a)},t.lineX1=function(){return e().x(n).y(r)},t.defined=function(e){return arguments.length?(s="function"==typeof e?e:Ye(!!e),t):s},t.curve=function(e){return arguments.length?(l=e,null!=o&&(h=l(o)),t):l},t.context=function(e){return arguments.length?(null==e?o=h=null:h=l(o=e),t):o},t};Y(Je);H.prototype={areaStart:function(){this._curve.areaStart()},areaEnd:function(){this._curve.areaEnd()},lineStart:function(){this._curve.lineStart()},lineEnd:function(){this._curve.lineEnd()},point:function(t,e){this._curve.point(e*Math.sin(t),e*-Math.cos(t))}};var ti={draw:function(t,e){var i=Math.sqrt(e/je);t.moveTo(i,0),t.arc(0,0,i,0,Ze)}},ei=function(){function t(){var t;if(n||(n=t=V()),e.apply(this,arguments).draw(n,+i.apply(this,arguments)),t)return n=null,t+""||null}var e=Ye(ti),i=Ye(64),n=null;return t.type=function(i){return arguments.length?(e="function"==typeof i?i:Ye(i),t):e},t.size=function(e){return arguments.length?(i="function"==typeof e?e:Ye(+e),t):i},t.context=function(e){return arguments.length?(n=null==e?null:e,t):n},t},ii=function(){};j.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:G(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:G(this,t,e)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}},X.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var t=this._x,e=this._y,i=t.length-1;if(i>0)for(var n,r=t[0],a=e[0],s=t[i]-r,o=e[i]-a,l=-1;++l<=i;)n=l/i,this._basis.point(this._beta*t[l]+(1-this._beta)*(r+n*s),this._beta*e[l]+(1-this._beta)*(a+n*o));this._x=this._y=null,this._basis.lineEnd()},point:function(t,e){this._x.push(+t),this._y.push(+e)}},function t(e){function i(t){return 1===e?new j(t):new X(t,e)}return i.beta=function(e){return t(+e)},i}(.85),Q.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:Z(this,this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2,this._x1=t,this._y1=e;break;case 2:this._point=3;default:Z(this,t,e)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}},function t(e){function i(t){return new Q(t,e)}return i.tension=function(e){return t(+e)},i}(0),J.prototype={areaStart:ii,areaEnd:ii,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._x3=t,this._y3=e;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=e);break;case 2:this._point=3,this._x5=t,this._y5=e;break;default:Z(this,t,e)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}},function t(e){function i(t){return new J(t,e)}return i.tension=function(e){return t(+e)},i}(0),K.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:Z(this,t,e)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}},function t(e){function i(t){return new K(t,e)}return i.tension=function(e){
return t(+e)},i}(0),tt.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){if(t=+t,e=+e,this._point){var i=this._x2-t,n=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(i*i+n*n,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3;default:$(this,t,e)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}},function t(e){function i(t){return e?new tt(t,e):new Q(t,0)}return i.alpha=function(e){return t(+e)},i}(.5),et.prototype={areaStart:ii,areaEnd:ii,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(t,e){if(t=+t,e=+e,this._point){var i=this._x2-t,n=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(i*i+n*n,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=t,this._y3=e;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=e);break;case 2:this._point=3,this._x5=t,this._y5=e;break;default:$(this,t,e)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}},function t(e){function i(t){return e?new et(t,e):new J(t,0)}return i.alpha=function(e){return t(+e)},i}(.5),it.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){if(t=+t,e=+e,this._point){var i=this._x2-t,n=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(i*i+n*n,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:$(this,t,e)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}},function t(e){function i(t){return e?new it(t,e):new K(t,0)}return i.alpha=function(e){return t(+e)},i}(.5),ot.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:st(this,this._t0,at(this,this._t0))}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){var i=NaN;if(t=+t,e=+e,t!==this._x1||e!==this._y1){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,st(this,at(this,i=rt(this,t,e)),i);break;default:st(this,this._t0,i=rt(this,t,e))}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e,this._t0=i}}},(lt.prototype=Object.create(ot.prototype)).point=function(t,e){ot.prototype.point.call(this,e,t)},ht.prototype={moveTo:function(t,e){this._context.moveTo(e,t)},closePath:function(){this._context.closePath()},lineTo:function(t,e){this._context.lineTo(e,t)},bezierCurveTo:function(t,e,i,n,r,a){this._context.bezierCurveTo(e,t,n,i,a,r)}};var ni=(Array.prototype.slice,Qe().cornerRadius(vt).padAngle(xt)),ri=$e().x(ct).y1(ut).y0(gt).defined(mt),ai=$e().y(ut).x1(ct).x0(pt).defined(mt),si=Ke().x(ct).y(ut).defined(mt),oi=e.pathTrail().x(ct).y(ut).defined(mt).size(dt),li=(e.pathRectangle().x(ct).y(ut).width(ft).height(_t).cornerRadius(vt),e.pathRectangle().x(0).y(0).width(ft).height(_t).cornerRadius(vt)),hi=(ei().type(bt).size(yt),function(t,e,i){var n=null==i.opacity?1:i.opacity,r=e._tx+e._origin[0],a=e._ty+e._origin[1];n<=0||0!==t.numTriangles&&(e.useProgram(e._shaderProgram),e.bindBuffer(e.ARRAY_BUFFER,t.triangleBuffer),e.vertexAttribPointer(e._coordLocation,3,e.FLOAT,!1,0,0),e.enableVertexAttribArray(e._coordLocation),e._lastTriangleBuffer=t.triangleBuffer,e.bindBuffer(e.ARRAY_BUFFER,t.colorBuffer),e.vertexAttribPointer(e._colorLocation,4,e.FLOAT,!1,0,0),e.enableVertexAttribArray(e._colorLocation),e._lastColorBuffer=t.colorBuffer,e.uniform2fv(e._offsetLocation,[r,a]),e.uniform4fv(e._clipLocation,e._clip),e.drawArrays(e.TRIANGLES,0,3*t.numTriangles))}),ci={},ui=function(t,e,n){if(!n)return[1,1,1];if(n.id)return[1,1,1];if(ci[n])return ci[n];var r=i.color(n).rgb();return ci[n]=[r.r/255,r.g/255,r.b/255],ci[n]},fi=function(t,e){return"number"==typeof t?t:"number"==typeof e?e:0},di=Ot,_i=wt,pi=Tt,gi={create:Ct,clone:kt,copy:di,scaleAndAdd:_i,dot:pi},vi=Vt,xi=Ft,mi=Dt,yi=Bt,bi=vi,Li=xi,Ai=mi,Si=yi,Ri=pi,Ei=[0,0],Oi=function(t,e,i,n,r){return bi(t,i,n),Ai(t,t),Li(e,-t[1],t[0]),Li(Ei,-i[1],i[0]),r/Ri(e,Ei)},wi=function(t,e){return Li(t,-e[1],e[0]),t},Ti=function(t,e,i){return Si(t,e,i),Ai(t,t),t},ki={computeMiter:Oi,normal:wi,direction:Ti},Ci=fi,Vi=gi,Fi=Vi.create(),Di=Vi.create(),Bi=Vi.create(),Ui=Vi.create(),Mi=Vi.create(),Pi=Vi.create(),qi=ki,zi=qi.computeMiter,Ii=qi.normal,Ni=qi.direction;Ut.prototype.mapThickness=function(t,e,i){return this.thickness},Ut.prototype.build=function(t){var e={positions:[],cells:[]};if(t.length<=1)return e;var i=t.length;this._lastFlip=-1,this._started=!1,this._normal=null;for(var n=1,r=0;n<i;n++){var a=t[n-1],s=t[n],o=n<t.length-1?t[n+1]:null,l=this.mapThickness(s,n,t),h=this._seg(e,r,a,s,o,l/2);r+=h}return e},Ut.prototype._seg=function(t,e,i,n,r,a){var s=0,o=t.cells,l=t.positions,h="square"===this.cap,c="bevel"===this.join;if(Ni(Bi,n,i),this._normal||(this._normal=Vi.create(),Ii(this._normal,Bi)),this._started||(this._started=!0,h&&(Vi.scaleAndAdd(Di,i,Bi,-a),i=Di),Mt(l,i,this._normal,a)),o.push([e+0,e+1,e+2]),r){Ni(Ui,r,n);var u=zi(Mi,Pi,Bi,Ui,a),f=Vi.dot(Mi,this._normal)<0?-1:1,d=c;if(!d&&"miter"===this.join){var _=u/a;_>this.miterLimit&&(d=!0)}d?(Vi.scaleAndAdd(Fi,n,this._normal,-a*f),l.push(Vi.clone(Fi)),Vi.scaleAndAdd(Fi,n,Pi,u*f),l.push(Vi.clone(Fi)),o.push(this._lastFlip!==-f?[e,e+2,e+3]:[e+2,e+1,e+3]),o.push([e+2,e+3,e+4]),Ii(Fi,Ui),Vi.copy(this._normal,Fi),Vi.scaleAndAdd(Fi,n,Fi,-a*f),l.push(Vi.clone(Fi)),s+=3):(Mt(l,n,Pi,u),o.push(1===this._lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3]),f=-1,Vi.copy(this._normal,Pi),s+=2),this._lastFlip=f}else Ii(this._normal,Bi),h&&(Vi.scaleAndAdd(Di,n,Bi,a),n=Di),Mt(l,n,this._normal,a),o.push(1===this._lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3]),s+=2;return s};var Wi=Ut,Hi=function(t,e,i){var n,r,a,s,o,l,h,c,u,f,d,_,p,g,v,x,m,y=null!=(y=e.strokeWidth)?y:1,b=null!=(b=e.strokeCap)?b:"butt",L=[],A=[],S=[],R=0,E=!1,O=!1,w=null==e.opacity?1:e.opacity,T=w*(null==e.fillOpacity?1:e.fillOpacity),k=w*(null==e.strokeOpacity?1:e.strokeOpacity),C=i.z||0,V=i.triangles;if("transparent"===e.fill&&(T=0),e.fill&&T>0&&(E=!0,R=V?V.length/9:0),"transparent"===e.stroke&&(k=0),y>0&&e.stroke&&k>0)for(O=!0,x=Wi({thickness:y,cap:b,join:"miter",miterLimit:1,closed:!!i.closed}),s=0;s<i.lines.length;s++)l=x.build(i.lines[s]),L.push(l),R+=l.cells.length;if(A=new Float32Array(3*R*3),S=new Float32Array(3*R*4),E){for(a=ui(t,e,e.fill),n=0,r=V.length;n<r;n+=3)A[n]=V[n],A[n+1]=V[n+1],A[n+2]=V[n+2];for(n=0,r=V.length/3;n<r;n++)S[4*n]=a[0],S[4*n+1]=a[1],S[4*n+2]=a[2],S[4*n+3]=T}if(O)for(a=ui(t,e,e.stroke),n=E?V.length/3:0,s=0;s<L.length;s++)for(l=L[s],d=l.positions,_=l.cells,p=l.cells.length,o=0;o<p;o++)h=_[o],c=d[h[0]],u=d[h[1]],f=d[h[2]],A[3*n]=c[0],A[3*n+1]=c[1],A[3*n+2]=C,S[4*n]=a[0],S[4*n+1]=a[1],S[4*n+2]=a[2],S[4*n+3]=k,n++,A[3*n]=u[0],A[3*n+1]=u[1],A[3*n+2]=C,S[4*n]=a[0],S[4*n+1]=a[1],S[4*n+2]=a[2],S[4*n+3]=k,n++,A[3*n]=f[0],A[3*n+1]=f[1],A[3*n+2]=C,S[4*n]=a[0],S[4*n+1]=a[1],S[4*n+2]=a[2],S[4*n+3]=k,n++;return g=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,g),t.bufferData(t.ARRAY_BUFFER,A,t.STATIC_DRAW),v=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,v),t.bufferData(t.ARRAY_BUFFER,S,t.STATIC_DRAW),m={triangleBuffer:g,colorBuffer:v,numTriangles:R},e._geom&&(e._geom.triangleBuffer&&t.deleteBuffer(e._geom.triangleBuffer),e._geom.colorBuffer&&t.deleteBuffer(e._geom.colorBuffer)),m},Yi=function(t,i){function n(t,n,r){e.sceneVisit(n,function(e){if(!r||r.intersects(e.bounds)){var n,a=e.x||0,s=e.y||0;t._tx+=a,t._ty+=s,(t._fullRedraw||e._dirty||!e._geom||e._geom.deleted)&&(n=i(t,e),e._geom=Hi(t,e,n)),hi(e._geom,t,e),t._tx-=a,t._ty-=s}})}return{type:t,drawGL:n}},Gi=Yi("arc",Lt),ji=function(t,e){function i(t,i,n){if(i.items.length&&(!n||n.intersects(i.bounds))){for(var r=i.items[0],a=!1,s=0;s<i.items.length;s++)if(i.items[s]._dirty){a=!0;break}if(t._fullRedraw||a||!r._geom||r._geom.deleted){var o=e(t,i.items);r._geom=Hi(t,r,o)}hi(r._geom,t,r)}}return{type:t,drawGL:i}},Xi=ji("area",At),Zi={type:"group",drawGL:Pt},Qi={type:"image",drawGL:Qt},Ji=ji("line",Rt),Ki={type:"path",drawGL:Jt},$i={type:"rect",drawGL:Kt},tn={type:"rule",drawGL:$t},en=Yi("shape",St),nn={type:"symbol",drawGL:te},rn={type:"text",drawGL:ee},an={arc:Gi,area:Xi,group:Zi,image:Qi,line:Ji,path:Ki,rect:$i,rule:tn,shape:en,symbol:nn,text:rn},sn=function(t,e){var i=t.prototype=Object.create(e.prototype);return i.constructor=t,i},on=function(t,e){var i=document.createElement("canvas");i.width=t,i.height=e;var n=i.getContext("webgl")||i.getContext("experimental-webgl");n._pathCache={},n._pathCacheSize=0,n._itemCache={},n._itemCacheSize=0,n._shapeCache={},n._shapeCacheSize=0,n._textCanvas=document.createElement("canvas"),n._textCanvas.width=t,n._textCanvas.height=e,n._textContext=n._textCanvas.getContext("2d"),i._textCanvas=n._textCanvas,n.clearColor(1,1,1,1),n.disable(n.CULL_FACE),n.disable(n.DEPTH_TEST),n.enable(n.BLEND),n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);var r="attribute vec3 coordinates;attribute vec4 color;uniform mat4 matrix;uniform float zFactor;uniform vec2 offset;varying vec4 vColor;varying vec4 vPosition;void main(void) {  vPosition = vec4(coordinates.x + offset.x, coordinates.y + offset.y, coordinates.z*zFactor - 1.0, 1.0);  gl_Position = matrix * vPosition;  vColor = color;}",a=n.createShader(n.VERTEX_SHADER);if(n.shaderSource(a,r),n.compileShader(a),!n.getShaderParameter(a,n.COMPILE_STATUS))throw n.getShaderInfoLog(a);var s="precision mediump float;varying vec4 vColor;varying vec4 vPosition;uniform vec4 clip;void main(void) {  if (vPosition.x < clip[0] || vPosition.x > clip[2] || vPosition.y < clip[1] || vPosition.y > clip[3]) {    discard;  }  gl_FragColor = vColor;}",o=n.createShader(n.FRAGMENT_SHADER);if(n.shaderSource(o,s),n.compileShader(o),!n.getShaderParameter(o,n.COMPILE_STATUS))throw n.getShaderInfoLog(o);var l=n.createProgram();if(n.attachShader(l,a),n.attachShader(l,o),n.linkProgram(l),n.useProgram(l),n._shaderProgram=l,n._coordLocation=n.getAttribLocation(n._shaderProgram,"coordinates"),n._colorLocation=n.getAttribLocation(n._shaderProgram,"color"),n._matrixLocation=n.getUniformLocation(n._shaderProgram,"matrix"),n._zFactorLocation=n.getUniformLocation(n._shaderProgram,"zFactor"),n._offsetLocation=n.getUniformLocation(n._shaderProgram,"offset"),n._clipLocation=n.getUniformLocation(n._shaderProgram,"clip"),r="attribute vec2 a_position;attribute vec2 a_texcoord;uniform mat4 u_matrix;varying vec2 v_texcoord;void main() {  gl_Position = u_matrix * vec4(a_position, -1.0, 1.0);  v_texcoord = a_texcoord;}",a=n.createShader(n.VERTEX_SHADER),n.shaderSource(a,r),n.compileShader(a),!n.getShaderParameter(a,n.COMPILE_STATUS))throw n.getShaderInfoLog(a);if(s="precision mediump float;varying vec2 v_texcoord;uniform sampler2D u_texture;void main() {  gl_FragColor = texture2D(u_texture, v_texcoord);}",o=n.createShader(n.FRAGMENT_SHADER),n.shaderSource(o,s),n.compileShader(o),!n.getShaderParameter(o,n.COMPILE_STATUS))throw n.getShaderInfoLog(o);l=n.createProgram(),n.attachShader(l,a),n.attachShader(l,o),n.linkProgram(l);var h=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,h);var c=[0,0,0,1,1,0,1,0,0,1,1,1];n.bufferData(n.ARRAY_BUFFER,new Float32Array(c),n.STATIC_DRAW);var u=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,u);var f=[0,0,0,1,1,0,1,0,0,1,1,1];if(n.bufferData(n.ARRAY_BUFFER,new Float32Array(f),n.STATIC_DRAW),n._imageShaderProgram=l,n._imagePositionLocation=n.getAttribLocation(n._imageShaderProgram,"a_position"),n._imageTexcoordLocation=n.getAttribLocation(n._imageShaderProgram,"a_texcoord"),n._imageMatrixLocation=n.getUniformLocation(n._imageShaderProgram,"u_matrix"),n._imageTextureLocation=n.getUniformLocation(n._imageShaderProgram,"u_texture"),n._imagePositionBuffer=h,n._imageTexcoordBuffer=u,r=["attribute vec3 pos;","attribute vec3 fillColor;","attribute vec3 strokeColor;","attribute float fillOpacity;","attribute float strokeWidth;","attribute float size;","attribute float shape;","attribute float strokeOpacity;","attribute vec2 unit;","uniform mat4 matrix;","varying vec4 positionVar;","varying vec4 fillColorVar;","varying vec4 strokeColorVar;","varying float sizeVar;","varying float shapeVar;","varying float strokeWidthVar;","varying vec2 unitVar;","void main(void)","{","  strokeWidthVar = strokeWidth;","  fillColorVar = vec4(fillColor, fillOpacity);","  strokeColorVar = vec4(strokeColor, strokeOpacity);","  if (shape == 0.0) {","    sizeVar = sqrt(size) / 2.0;","  }","  if (shape == 1.0) {","    sizeVar = sqrt(size) / 2.0;","  }","  if (shape == 2.0) {","    sizeVar = sqrt(size) / 2.0;","  }","  if (shape == 3.0) {","    sizeVar = sqrt(2.0) * sqrt(size) / 2.0;","  }","  if (shape == 4.0) {","    sizeVar = sqrt(size) / 2.0;","  }","  if (shape == 5.0) {","    sizeVar = (sqrt(6.0)/2.0) * sqrt(size) / 2.0;","  }","  if (shape == 6.0) {","    sizeVar = (sqrt(6.0)/2.0) * sqrt(size) / 2.0;","  }","  if (shape == 7.0) {","    sizeVar = (sqrt(6.0)/2.0) * sqrt(size) / 2.0;","  }","  if (shape == 8.0) {","    sizeVar = (sqrt(6.0)/2.0) * sqrt(size) / 2.0;","  }","  if (shape == 9.0) {","    sizeVar = sqrt(size) / 2.0;","  }","  shapeVar = shape;","  float factor = (sizeVar + strokeWidth / 2.0 + 1.0) / sizeVar;","  unitVar = factor * unit;","  positionVar = vec4(pos.xy + factor * sizeVar * unit, -1.0, 1.0);","  gl_Position = matrix * positionVar;","}"].join("\n"),a=n.createShader(n.VERTEX_SHADER),n.shaderSource(a,r),n.compileShader(a),!n.getShaderParameter(a,n.COMPILE_STATUS))throw n.getShaderInfoLog(a);if(s=["precision mediump float;","const float PI = 3.1415926535897932384626433832795;","varying vec4 positionVar;","varying vec4 fillColorVar;","varying vec4 strokeColorVar;","varying vec2 unitVar;","varying float sizeVar;","varying float shapeVar;","varying float strokeWidthVar;","uniform vec4 clip;","float distToLine(vec2 pt1, vec2 pt2, vec2 testPt)","{","  vec2 lineDir = pt2 - pt1;","  vec2 perpDir = vec2(lineDir.y, -lineDir.x);","  vec2 dirToPt1 = pt1 - testPt;","  return dot(normalize(perpDir), dirToPt1);","}","float distToAngle(vec2 apex, vec2 left, vec2 right, vec2 testPt)","{","  float dist = distToLine(apex, left, testPt);","  dist = min(dist, distToLine(right, apex, testPt));","  float cut = distToLine(left, right, testPt);","  if (cut < 0.0) return -1.0;","  return dist;","}","float distToHull(vec2 p1, vec2 p2, vec2 p3, vec2 p4, vec2 testPt)","{","  float dist = distToLine(p1, p2, testPt);","  dist = min(dist, distToLine(p2, p3, testPt));","  dist = min(dist, distToLine(p4, p1, testPt));","  float cut = distToLine(p3, p4, testPt);","  if (cut < 0.0) return -1.0;","  return dist;","}","vec2 rotate(vec2 pt, float a)","{","  return vec2(cos(a)*pt.x - sin(a)*pt.y, sin(a)*pt.x + cos(a)*pt.y);","}","void main () {","  if (positionVar.x < clip[0] || positionVar.x > clip[2] || positionVar.y < clip[1] || positionVar.y > clip[3]) {","    discard;","  }","  float dist;","  float d1;","  float d2;","  if (shapeVar == 0.0) {","    dist = length(unitVar);","  }","  if (shapeVar == 1.0) {","    float inset = 1.0 / 2.5;","    d1 = distToLine(vec2(-inset, -1.0), vec2(inset, -1.0), unitVar);","    d1 = min(d1, distToLine(vec2(inset, -1.0), vec2(inset, 1.0), unitVar));","    d1 = min(d1, distToLine(vec2(inset, 1.0), vec2(-inset, 1.0), unitVar));","    d1 = min(d1, distToLine(vec2(-inset, 1.0), vec2(-inset, -1.0), unitVar));","    d1 = 1.0 - d1;","    d2 = distToLine(vec2(1.0, -inset), vec2(1.0, inset), unitVar);","    d2 = min(d2, distToLine(vec2(1.0, inset), vec2(-1.0, inset), unitVar));","    d2 = min(d2, distToLine(vec2(-1.0, inset), vec2(-1.0, -inset), unitVar));","    d2 = min(d2, distToLine(vec2(-1.0, -inset), vec2(1.0, -inset), unitVar));","    d2 = 1.0 - d2;","    dist = min(d1, d2);","  }","  if (shapeVar == 2.0) {","    dist = distToLine(vec2(0.0, -1.0), vec2(1.0, 0.0), unitVar);","    dist = min(dist, distToLine(vec2(1.0, 0.0), vec2(0.0, 1.0), unitVar));","    dist = min(dist, distToLine(vec2(0.0, 1.0), vec2(-1.0, 0.0), unitVar));","    dist = min(dist, distToLine(vec2(-1.0, 0.0), vec2(0.0, -1.0), unitVar));","    dist = 1.0 - dist;","  }","  if (shapeVar == 3.0) {","    float side = sqrt(2.0)/2.0;","    dist = distToLine(vec2(-side, -side), vec2(side, -side), unitVar);","    dist = min(dist, distToLine(vec2(side, -side), vec2(side, side), unitVar));","    dist = min(dist, distToLine(vec2(side, side), vec2(-side, side), unitVar));","    dist = min(dist, distToLine(vec2(-side, side), vec2(-side, -side), unitVar));","    dist = 1.0 - dist;","  }","  if (shapeVar == 4.0) {","    float h = 1.0;","    float x = h * tan(PI/10.0);","    vec2 p1 = vec2(0.0, -h);","    vec2 p2 = vec2(x, 0);","    vec2 p3 = vec2(-x, 0);","    float angle = 0.0;","    dist = 1.0 - distToAngle(rotate(p1, angle), rotate(p2, angle), rotate(p3, angle), unitVar);","    angle = angle + 2.0*PI/5.0;","    dist = min(dist, 1.0 - distToAngle(rotate(p1, angle), rotate(p2, angle), rotate(p3, angle), unitVar));","    angle = angle + 2.0*PI/5.0;","    dist = min(dist, 1.0 - distToAngle(rotate(p1, angle), rotate(p2, angle), rotate(p3, angle), unitVar));","    angle = angle + 2.0*PI/5.0;","    dist = min(dist, 1.0 - distToAngle(rotate(p1, angle), rotate(p2, angle), rotate(p3, angle), unitVar));","    angle = angle + 2.0*PI/5.0;","    dist = min(dist, 1.0 - distToAngle(rotate(p1, angle), rotate(p2, angle), rotate(p3, angle), unitVar));","  }","  if (shapeVar == 5.0) {","    vec2 p1 = vec2(0.0, -sqrt(2.0)/2.0);","    vec2 p2 = vec2(sqrt(6.0)/3.0, sqrt(2.0)/2.0);","    vec2 p3 = vec2(-sqrt(6.0)/3.0, sqrt(2.0)/2.0);","    dist = distToLine(p1, p2, unitVar);","    dist = min(dist, distToLine(p2, p3, unitVar));","    dist = min(dist, distToLine(p3, p1, unitVar));","    dist = 1.0 - dist;","  }","  if (shapeVar == 6.0) {","    vec2 p1 = vec2(sqrt(2.0)/2.0, 0.0);","    vec2 p2 = vec2(-sqrt(2.0)/2.0, sqrt(6.0)/3.0);","    vec2 p3 = vec2(-sqrt(2.0)/2.0, -sqrt(6.0)/3.0);","    dist = distToLine(p1, p2, unitVar);","    dist = min(dist, distToLine(p2, p3, unitVar));","    dist = min(dist, distToLine(p3, p1, unitVar));","    dist = 1.0 - dist;","  }","  if (shapeVar == 7.0) {","    vec2 p1 = vec2(0.0, sqrt(2.0)/2.0);","    vec2 p2 = vec2(-sqrt(6.0)/3.0, -sqrt(2.0)/2.0);","    vec2 p3 = vec2(sqrt(6.0)/3.0, -sqrt(2.0)/2.0);","    dist = distToLine(p1, p2, unitVar);","    dist = min(dist, distToLine(p2, p3, unitVar));","    dist = min(dist, distToLine(p3, p1, unitVar));","    dist = 1.0 - dist;","  }","  if (shapeVar == 8.0) {","    vec2 p1 = vec2(-sqrt(2.0)/2.0, 0.0);","    vec2 p2 = vec2(sqrt(2.0)/2.0, -sqrt(6.0)/3.0);","    vec2 p3 = vec2(sqrt(2.0)/2.0, sqrt(6.0)/3.0);","    dist = distToLine(p1, p2, unitVar);","    dist = min(dist, distToLine(p2, p3, unitVar));","    dist = min(dist, distToLine(p3, p1, unitVar));","    dist = 1.0 - dist;","  }","  if (shapeVar == 9.0) {","    float h = 12.0 / (12.0 + sqrt(12.0));","    float y = h / sqrt(12.0) + h;","    vec2 p1 = vec2(h / 2.0, y);","    vec2 p2 = vec2(-h / 2.0, y);","    vec2 p3 = vec2(-h / 2.0, 0.0);","    vec2 p4 = vec2(h / 2.0, 0.0);","    float angle = 0.0;","    dist = 1.0 - distToHull(p1, p2, p3, p4, unitVar);","    angle = angle + 2.0*PI/3.0;","    dist = min(dist, 1.0 - distToHull(rotate(p1, angle), rotate(p2, angle), rotate(p3, angle), rotate(p4, angle), unitVar));","    angle = angle + 2.0*PI/3.0;","    dist = min(dist, 1.0 - distToHull(rotate(p1, angle), rotate(p2, angle), rotate(p3, angle), rotate(p4, angle), unitVar));","  }","  float endStep = 1.0;","  float antialiasDist = 1.0 / sizeVar / 2.0;","  float widthDist = strokeWidthVar / sizeVar / 2.0;","  vec4 c1;","  vec4 c2;","  float step;","  if (dist < endStep) {","    step = smoothstep(endStep - widthDist - antialiasDist, endStep - widthDist + antialiasDist, dist);","    if (fillColorVar.a > 0.0) {","      c1 = fillColorVar;","    } else {","      c1 = vec4(strokeColorVar.rgb, 0.0);","    }","    if (strokeColorVar.a > 0.0) {","      c2 = strokeColorVar;","    } else {","      c2 = vec4(fillColorVar.rgb, 0.0);","    }","  } else {","    step = smoothstep(endStep + widthDist - antialiasDist, endStep + widthDist + antialiasDist, dist);","    if (strokeColorVar.a > 0.0) {","      c1 = strokeColorVar;","      c2 = vec4(strokeColorVar.rgb, 0.0);","    } else {","      c1 = vec4(fillColorVar.rgb, 0.0);","      c2 = vec4(fillColorVar.rgb, 0.0);","    }","  }","  gl_FragColor = mix(c1, c2, step);","}"].join("\n"),o=n.createShader(n.FRAGMENT_SHADER),n.shaderSource(o,s),n.compileShader(o),!n.getShaderParameter(o,n.COMPILE_STATUS))throw n.getShaderInfoLog(o);if(l=n.createProgram(),n.attachShader(l,a),n.attachShader(l,o),n.linkProgram(l),n._symbolShaderProgram=l,n._symbolPosLocation=n.getAttribLocation(l,"pos"),n._symbolFillColorLocation=n.getAttribLocation(l,"fillColor"),n._symbolStrokeColorLocation=n.getAttribLocation(l,"strokeColor"),n._symbolFillOpacityLocation=n.getAttribLocation(l,"fillOpacity"),n._symbolStrokeWidthLocation=n.getAttribLocation(l,"strokeWidth"),n._symbolSizeLocation=n.getAttribLocation(l,"size"),n._symbolShapeLocation=n.getAttribLocation(l,"shape"),n._symbolStrokeOpacityLocation=n.getAttribLocation(l,"strokeOpacity"),n._symbolUnitLocation=n.getAttribLocation(l,"unit"),n._symbolMatrixLocation=n.getUniformLocation(l,"matrix"),n._symbolClipLocation=n.getUniformLocation(l,"clip"),r=["attribute vec3 pos;","attribute vec3 fillColor;","attribute vec3 strokeColor;","attribute float fillOpacity;","attribute float strokeWidth;","attribute float strokeOpacity;","attribute float cornerRadius;","attribute vec2 size;","attribute vec2 unit;","uniform mat4 matrix;","varying vec4 fillColorVar;","varying vec4 strokeColorVar;","varying float strokeWidthVar;","varying float cornerRadiusVar;","varying float factorVar;","varying vec2 sizeVar;","varying vec2 unitVar;","varying vec4 positionVar;","void main(void)","{","  strokeWidthVar = strokeWidth;","  fillColorVar = vec4(fillColor, fillOpacity);","  strokeColorVar = vec4(strokeColor, strokeOpacity);","  cornerRadiusVar = cornerRadius;","  sizeVar = size;","  unitVar = unit;","  factorVar = max(size.x, size.y) + strokeWidth + 1.0;","  positionVar = vec4(pos.xy + factorVar*unitVar - 0.5*strokeWidth - 0.5, -1.0, 1.0);","  gl_Position = matrix * positionVar;","}"].join("\n"),a=n.createShader(n.VERTEX_SHADER),n.shaderSource(a,r),n.compileShader(a),!n.getShaderParameter(a,n.COMPILE_STATUS))throw n.getShaderInfoLog(a);if(s=["precision mediump float;","const float PI = 3.1415926535897932384626433832795;","varying vec4 fillColorVar;","varying vec4 strokeColorVar;","varying float strokeWidthVar;","varying float cornerRadiusVar;","varying float factorVar;","varying vec2 unitVar;","varying vec2 sizeVar;","varying vec4 positionVar;","uniform vec4 clip;","float distToLine(vec2 pt1, vec2 pt2, vec2 testPt)","{","  vec2 lineDir = pt2 - pt1;","  vec2 perpDir = vec2(lineDir.y, -lineDir.x);","  vec2 dirToPt1 = pt1 - testPt;","  return dot(normalize(perpDir), dirToPt1);","}","float cornerDist(vec2 pt, float radius, float xdir, float ydir, vec2 testPt)","{","  if (xdir * (pt.x - testPt.x) > 0.0) return 1.0;","  if (ydir * (pt.y - testPt.y) > 0.0) return 1.0;","  return radius - length(pt - testPt);","}","void main () {","  if (positionVar.x < clip[0] || positionVar.x > clip[2] || positionVar.y < clip[1] || positionVar.y > clip[3]) {","    discard;","  }","  float delta = (0.5 + 0.5*strokeWidthVar)/factorVar;","  float xmax = (0.5 + 0.5*strokeWidthVar + sizeVar.x)/factorVar;","  float ymax = (0.5 + 0.5*strokeWidthVar + sizeVar.y)/factorVar;","  vec2 p1 = vec2(delta, delta);","  vec2 p2 = vec2(xmax, delta);","  vec2 p3 = vec2(xmax, ymax);","  vec2 p4 = vec2(delta, ymax);","  float dist = distToLine(p1, p2, unitVar);","  dist = min(dist, distToLine(p2, p3, unitVar));","  dist = min(dist, distToLine(p3, p4, unitVar));","  dist = min(dist, distToLine(p4, p1, unitVar));","  if (cornerRadiusVar > 0.0) {","    delta = (0.5 + 0.5*strokeWidthVar + cornerRadiusVar)/factorVar;","    xmax = (0.5 + 0.5*strokeWidthVar + sizeVar.x - cornerRadiusVar)/factorVar;","    ymax = (0.5 + 0.5*strokeWidthVar + sizeVar.y - cornerRadiusVar)/factorVar;","    p1 = vec2(delta, delta);","    p2 = vec2(xmax, delta);","    p3 = vec2(xmax, ymax);","    p4 = vec2(delta, ymax);","    dist = min(dist, cornerDist(p1, cornerRadiusVar/factorVar, -1.0, -1.0, unitVar));","    dist = min(dist, cornerDist(p2, cornerRadiusVar/factorVar, 1.0, -1.0, unitVar));","    dist = min(dist, cornerDist(p3, cornerRadiusVar/factorVar, 1.0, 1.0, unitVar));","    dist = min(dist, cornerDist(p4, cornerRadiusVar/factorVar, -1.0, 1.0, unitVar));","  }","  dist = 1.0 - dist;","  float endStep = 1.0;","  float antialiasDist = 0.5 / factorVar;","  float widthDist = 0.5*strokeWidthVar / factorVar;","  vec4 c1;","  vec4 c2;","  float step;","  if (dist < endStep) {","    step = smoothstep(endStep - widthDist - antialiasDist, endStep - widthDist + antialiasDist, dist);","    if (fillColorVar.a > 0.0) {","      c1 = fillColorVar;","    } else {","      c1 = vec4(strokeColorVar.rgb, 0.0);","    }","    if (strokeWidthVar > 0.0) {","      c2 = strokeColorVar;","    } else {","      c2 = vec4(fillColorVar.rgb, 0.0);","    }","  } else {","    step = smoothstep(endStep + widthDist - antialiasDist, endStep + widthDist + antialiasDist, dist);","    if (strokeWidthVar > 0.0) {","      c1 = strokeColorVar;","      c2 = vec4(strokeColorVar.rgb, 0.0);","    } else {","      c1 = vec4(fillColorVar.rgb, 0.0);","      c2 = vec4(fillColorVar.rgb, 0.0);","    }","  }","  gl_FragColor = mix(c1, c2, step);","}"].join("\n"),o=n.createShader(n.FRAGMENT_SHADER),n.shaderSource(o,s),n.compileShader(o),!n.getShaderParameter(o,n.COMPILE_STATUS))throw n.getShaderInfoLog(o);return l=n.createProgram(),n.attachShader(l,a),n.attachShader(l,o),n.linkProgram(l),n._rectShaderProgram=l,n._rectPosLocation=n.getAttribLocation(l,"pos"),n._rectFillColorLocation=n.getAttribLocation(l,"fillColor"),n._rectStrokeColorLocation=n.getAttribLocation(l,"strokeColor"),n._rectFillOpacityLocation=n.getAttribLocation(l,"fillOpacity"),n._rectStrokeWidthLocation=n.getAttribLocation(l,"strokeWidth"),n._rectSizeLocation=n.getAttribLocation(l,"size"),n._rectStrokeOpacityLocation=n.getAttribLocation(l,"strokeOpacity"),n._rectCornerRadiusLocation=n.getAttribLocation(l,"cornerRadius"),n._rectUnitLocation=n.getAttribLocation(l,"unit"),n._rectMatrixLocation=n.getUniformLocation(l,"matrix"),n._rectClipLocation=n.getUniformLocation(l,"clip"),i},ln="undefined"!=typeof window?window.devicePixelRatio||1:1,hn=function(t,e,i,n){var r="undefined"!=typeof HTMLElement&&t instanceof HTMLElement&&null!=t.parentNode,a=t.getContext("webgl")||t.getContext("experimental-webgl"),s=r?ln:1;return t.width=e*s,t.height=i*s,a._textCanvas.width=e*s,a._textCanvas.height=i*s,a._textContext.pixelRatio=s,a._textContext.setTransform(s,0,0,s,s*n[0],s*n[1]),1!==s&&(t.style.width=e+"px",t.style.height=i+"px"),a.lineWidth(s),a.viewport(0,0,a.canvas.width,a.canvas.height),a._origin=n,a._ratio=s,a._clip=[0,0,t.width/a._ratio,t.height/a._ratio],t},cn=sn(ie,e.Renderer),un=e.Renderer.prototype;cn.initialize=function(t,i,n,r){return this._canvas=on(1,1),t&&(e.domClear(t,0).appendChild(this._canvas),this._canvas.setAttribute("class","marks")),un.initialize.call(this,t,i,n,r)},cn.resize=function(t,e,i){return un.resize.call(this,t,e,i),hn(this._canvas,this._width,this._height,this._origin),this._redraw=!0,this},cn.canvas=function(){return this._canvas},cn.context=function(){return this._canvas?this._canvas.getContext("webgl")||this._canvas.getContext("experimental-webgl"):null},cn.rotate=function(t,e,i){return this._angleX=t,this._angleY=e,this._angleZ=i,this},cn.translate=function(t,e,i){return this._translateX=t,this._translateY=e,this._translateZ=i,this},cn.zFactor=function(t){return this._zFactor=t,this},cn.depthTest=function(t){return this._depthTest=t,this},cn.randomZ=function(t){return this._randomZ=t,this},cn._updateUniforms=function(){var t=this.context();t.useProgram(t._shaderProgram);var e=t.canvas.width/t._ratio,i=t.canvas.height/t._ratio,n=[2/e,0,0,0,0,-2/e,0,0,0,0,1,0,-1,i/e,0,1];this.matrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.matrix=qt(this.matrix,zt(Math.PI/2,e/i,.01,3e3)),this.matrix=qt(this.matrix,Ht(this._translateX,this._translateY,(this._translateZ-1)*i/e)),this.matrix=qt(this.matrix,Wt(this._angleZ)),this.matrix=qt(this.matrix,Nt(this._angleY)),this.matrix=qt(this.matrix,It(this._angleX)),this.matrix=qt(this.matrix,Ht(0,0,1)),this.matrix=qt(this.matrix,n),t._matrix=this.matrix,t.uniform1f(t._zFactorLocation,this._zFactor),t.uniformMatrix4fv(t._matrixLocation,!1,this.matrix)},cn._render=function(t,i){var n,r,a=this.context();if(a._tx=0,a._ty=0,a._triangleGeometry=[],a._triangleColor=[],a._images)for(r=0;r<a._images.length;r++)a.deleteTexture(a._images[r].texture);if(a._images=[],a._randomZ=this._randomZ,a._pathCacheHit=0,a._pathCacheMiss=0,a._itemCacheHit=0,a._itemCacheMiss=0,a._shapeCacheHit=0,a._shapeCacheMiss=0,n=!i||this._redraw?(this._redraw=!1,null):void 0,i)for(r=0;r<i.length;r++)i[r]._dirty=!0,i[r].exit&&e.Marks[i[r].mark.marktype].nested&&i[r].mark.items.length&&(i[r].mark.items[0]._dirty=!0);else a._fullRedraw=!0;this._depthTest?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this._updateUniforms(),this.clear(),this.draw(a,t,n);var s=Yt(a,a._textCanvas);for(s.x=0,s.y=0,s.w=a.canvas.width/a._ratio,s.h=a.canvas.height/a._ratio,a._images.push(s),r=0;r<a._images.length;r++)Gt(a,a._images[r],this.matrix);if(i)for(r=0;r<i.length;r++)i[r]._dirty=!1;return a._fullRedraw=!1,this._lastScene=t,this},cn.frame=function(){return this._lastScene&&this._render(this._lastScene,[]),this},cn.draw=function(t,e,i){var n=an[e.marktype];n.drawGL&&n.drawGL.call(this,t,e,i)},cn.toDataURL=function(t){return this.render(t,null),this.canvas().toDataURL("image/png",1)},cn.clear=function(){var t,e=this.context();null!=this._bgcolor?(t=ui(e,null,this._bgcolor),e.clearColor(t[0],t[1],t[2],1)):e.clearColor(1,1,1,1),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e._textContext.save(),e._textContext.setTransform(1,0,0,1,0,0),e._textContext.clearRect(0,0,e._textCanvas.width,e._textCanvas.height),
e._textContext.restore()},e.CanvasHandler.prototype.context=function(){return this._canvas.getContext("2d")||this._canvas._textCanvas.getContext("2d")},e.renderModule("webgl",{handler:e.CanvasHandler,renderer:ie}),t.WebGLRenderer=ie,Object.defineProperty(t,"__esModule",{value:!0})});